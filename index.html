<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ±äº¬æ¥µè‡´æ—…èªŒ | TOKYO TYPOGRAPHIC JOURNAL</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Noto+Sans+TC:wght@300;400;500;700&family=Noto+Serif+JP:wght@900&family=Shippori+Mincho:wght@700&display=swap" rel="stylesheet">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'tokyo-bg': '#F5F5F7',
                        'tokyo-ink': '#1A1A1A',
                        'tokyo-blue': '#223A70',
                        'tokyo-gray': '#E0E0E0',
                        'tokyo-gold': '#C5A059',
                        'tokyo-accent': '#D1D5DB'
                    },
                    fontFamily: {
                        sans: ['"Noto Sans TC"', '"Noto Sans JP"', 'sans-serif'],
                        serif: ['"Shippori Mincho"', '"Noto Serif JP"', 'serif'],
                        mono: ['Courier New', 'monospace'],
                    },
                    screens: { 'print': {'raw': 'print'} }
                }
            }
        }
    </script>
    <style>
        body { background-color: #F5F5F7; color: #1A1A1A; -webkit-font-smoothing: antialiased; }
        .typo-header { line-height: 0.9; letter-spacing: -0.03em; }
        .bright-card { background: #FFFFFF; border: 1px solid #1A1A1A; box-shadow: 4px 4px 0px 0px #223A70; transition: all 0.2s ease; }
        .highlight-number { font-size: 1.5rem; line-height: 1.2; font-weight: 700; letter-spacing: -0.01em; }
        @media (min-width: 768px) { .highlight-number { font-size: 2rem; } }
        @media print {
            body { background-color: white !important; color: black !important; font-size: 10pt; }
            #app-header, #app-container, footer, .no-print, button, #magic-notebook-btn { display: none !important; }
            #print-container { display: block !important; width: 100% !important; margin: 0 !important; padding: 0 !important; }
            .print-page-break { page-break-before: always; }
        }
        #print-container { display: none; }
        input[type="checkbox"] { accent-color: #223A70; }
        #nav-container::-webkit-scrollbar { display: none; }
        #nav-container { -ms-overflow-style: none; scrollbar-width: none; }
        .timeline-dot { position: absolute; left: -6px; top: 8px; width: 12px; height: 12px; background-color: #223A70; border: 2px solid #F5F5F7; border-radius: 999px; }
        #toast-container { position: fixed; bottom: 20px; left: 20px; z-index: 9999; display: flex; flex-direction: column; gap: 10px; pointer-events: none; }
        .toast { background-color: #1A1A1A; color: white; padding: 10px 20px; border-radius: 4px; font-size: 12px; font-weight: bold; box-shadow: 0 4px 6px rgba(0,0,0,0.1); opacity: 0; transform: translateY(20px); transition: all 0.3s ease; display: flex; items-center; gap: 8px; border-left: 4px solid #C5A059; }
        .toast.show { opacity: 1; transform: translateY(0); }
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(26, 26, 26, 0.85); z-index: 9999; display: none; align-items: center; justify-content: center; padding: 20px; backdrop-filter: blur(4px); }
        .modal-overlay.active { display: flex; }
        .modal-content { background: #F5F5F7; width: 100%; max-width: 800px; height: 85vh; border: 4px solid #1A1A1A; box-shadow: 8px 8px 0px 0px #223A70; display: flex; flex-direction: column; overflow: hidden; animation: modalPop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes modalPop { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .notebook-paper { background-color: #FFFFFF; background-image: none; font-size: 13px; line-height: 1.8; color: #1A1A1A; font-family: 'Courier New', monospace; border: none; }
        .notebook-paper::-webkit-scrollbar { width: 8px; }
        .notebook-paper::-webkit-scrollbar-track { background: transparent; }
        .notebook-paper::-webkit-scrollbar-thumb { background-color: #D1D5DB; border-radius: 4px; }
        .tool-card { transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
        .tool-card:hover { transform: translateY(-4px); box-shadow: 8px 8px 0px 0px #223A70; }
        .tool-card:active { transform: translateY(-1px); box-shadow: 4px 4px 0px 0px #223A70; }
        .fab-enter { animation: fabPop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes fabPop { from { transform: scale(0) rotate(-90deg); opacity: 0; } to { transform: scale(1) rotate(0); opacity: 1; } }
    </style>
</head>
<body class="min-h-screen flex flex-col font-sans selection:bg-tokyo-blue selection:text-white pb-20 lg:pb-0"> 
    
    <header id="app-header" class="bg-tokyo-blue text-white p-6 md:p-8 border-b-4 border-tokyo-ink relative">
        <button id="magic-notebook-btn" onclick="openNotebook()" class="absolute top-2 right-2 md:top-4 md:right-4 z-50 bg-white text-tokyo-ink px-3 py-2 border border-tokyo-ink shadow-[2px_2px_0px_0px_#1A1A1A] hover:translate-y-0.5 hover:shadow-none transition-all group rounded-sm flex items-center gap-2" title="é–‹å•Ÿæ‰‹å¸³æç¤ºè© (Prompt Source)">
            <i data-lucide="sparkles" class="w-4 h-4 text-tokyo-blue fill-tokyo-blue"></i>
            <span class="hidden md:inline text-xs font-bold tracking-widest text-tokyo-blue uppercase">æç¤ºè©</span>
        </button>
        <div class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-4 items-end relative z-10">
            <div class="lg:col-span-8">
                <p class="text-[10px] font-bold tracking-[0.2em] mb-2 uppercase border-b border-white/40 pb-1 inline-block">Tokyo Guide 2025</p>
                <h1 class="text-5xl md:text-7xl font-serif font-bold typo-header">TOKYO.</h1>
            </div>
            <div class="lg:col-span-4 flex flex-col items-start lg:items-end justify-between h-full pt-2 lg:pt-0">
                <div class="mt-4 text-left lg:text-right border-l-2 lg:border-l-0 lg:border-r-2 border-white pl-3 lg:pl-0 lg:pr-3">
                    <p class="text-lg font-serif font-bold tracking-tight">æ±äº¬ã®å¿ƒ</p>
                    <p class="text-[10px] opacity-90 mt-1">æ±Ÿæˆ¸å‚³çµ±èˆ‡ç¾ä»£éœ“è™¹</p>
                </div>
            </div>
        </div>
    </header>

    <main id="app-container" class="flex-grow max-w-6xl mx-auto w-full p-4 md:p-6 lg:p-8">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 lg:gap-8">
            <aside class="lg:col-span-3 space-y-4 order-1">
                <nav class="sticky top-4 z-30 bg-tokyo-bg border-b border-tokyo-ink/10 lg:border-none pb-2 transition-all">
                    <div id="nav-container" class="flex flex-row lg:flex-col overflow-x-auto lg:overflow-visible gap-1 pb-1 lg:pb-0"></div>
                </nav>
                <div id="flight-widget" class="grid grid-cols-1 gap-4 sidebar-widget z-10 relative"></div>
            </aside>
            <section class="lg:col-span-9 min-h-[500px] order-2">
                <div id="section-header" class="mb-6 border-b-2 border-tokyo-ink pb-3"></div>
                <div id="content-area"></div>
            </section>
        </div>
    </main>

    <div id="print-container"><div id="print-content-body"></div></div>
    <div id="toast-container"></div>

    <button onclick="switchTab('toolbox')" class="fab-enter fixed bottom-6 right-6 z-40 bg-tokyo-blue text-white w-14 h-14 rounded-full shadow-[4px_4px_0px_0px_#1A1A1A] hover:translate-y-1 hover:shadow-none transition-all flex items-center justify-center border-2 border-tokyo-ink group" title="å¿«é€Ÿé–‹å•Ÿå·¥å…·ç®±">
        <i data-lucide="briefcase" class="w-6 h-6 group-hover:scale-110 transition-transform"></i>
        <span class="absolute -top-2 -right-1 flex h-4 w-4">
            <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-tokyo-gold opacity-75"></span>
            <span class="relative inline-flex rounded-full h-4 w-4 bg-tokyo-gold"></span>
        </span>
    </button>

    <div id="notebook-modal" class="modal-overlay" onclick="if(event.target===this) closeNotebook()">
        <div class="modal-content">
            <div class="bg-tokyo-ink text-white p-3 flex justify-between items-center border-b-4 border-tokyo-blue shadow-sm z-10">
                <div class="flex items-center gap-2">
                    <i data-lucide="book-open" class="w-4 h-4 text-tokyo-gold"></i>
                    <h3 class="font-serif font-bold text-sm tracking-wider uppercase">æ‰‹å¸³æç¤ºè© / Prompt Source</h3>
                </div>
                <button onclick="closeNotebook()" class="hover:text-tokyo-gold transition-colors"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>
            <div class="flex-grow p-0 overflow-hidden relative">
                <textarea id="notebook-content" class="notebook-paper w-full h-full p-8 font-mono resize-none focus:outline-none" readonly></textarea>
                <div class="absolute bottom-6 right-6 flex gap-3">
                    <button onclick="copyNotebookContent()" class="bg-tokyo-blue text-white px-5 py-2 font-bold uppercase shadow-lg hover:bg-blue-900 hover:scale-105 transition-all flex items-center gap-2 rounded-sm text-xs tracking-widest border border-tokyo-ink">
                        <i data-lucide="copy" class="w-3 h-3"></i> Copy Source
                    </button>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-tokyo-ink text-tokyo-bg py-8 mt-12 border-t-4 border-tokyo-blue">
        <div class="max-w-6xl mx-auto px-6 flex flex-col md:flex-row justify-between items-center gap-4 text-center md:text-left">
            <div>
                <h3 class="font-serif text-xl font-bold mb-1 tracking-tight">æ±äº¬æ¥µè‡´æ—…èªŒ</h3>
                <p class="text-[10px] font-mono opacity-50 uppercase tracking-[0.2em]">Designed for Efficiency</p>
            </div>
            <button onclick="window.scrollTo({top: 0, behavior: 'smooth'})" class="border border-tokyo-bg px-6 py-2 hover:bg-tokyo-bg hover:text-tokyo-ink transition-all font-bold text-xs uppercase tracking-wider">Top</button>
        </div>
    </footer>

    <!-- Hidden Input -->
    <input type="file" id="fileImportShopping" accept=".json" style="display: none;" onchange="handleFileImport(this, 'shopping')">
    <input type="file" id="fileImportPacking" accept=".json" style="display: none;" onchange="handleFileImport(this, 'packing')">

    <script>
        const STORAGE_KEY = 'tokyo_v24_final_stable';
        let currentState = { activeTab: 'day1', activeToolId: null, activePhraseCategory: null, showTextBackup: false };

        function showToast(msg) {
            const container = document.getElementById('toast-container');
            const el = document.createElement('div');
            el.className = 'toast';
            el.innerHTML = `<span>${msg}</span>`;
            container.appendChild(el);
            setTimeout(()=>el.classList.add('show'), 10);
            setTimeout(()=>{ el.classList.remove('show'); setTimeout(()=>el.remove(), 300); }, 2000);
        }

        function getMapUrl(q) { return `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(q + " æ±äº¬")}`; }
        function getDailyRouteUrl(tl) { 
            if (!tl || tl.length === 0) return "#";
            const locs = tl.map(i => i.title + " æ±äº¬"); 
            return `https://www.google.com/maps/dir/?api=1&origin=${encodeURIComponent(locs[0])}&destination=${encodeURIComponent(locs[locs.length-1])}&waypoints=${encodeURIComponent(locs.slice(1,-1).join('|'))}&travelmode=transit`; 
        }
        function getSearchUrl(title) { return `https://www.google.com/search?q=${encodeURIComponent(title + " æ±äº¬ éŠè¨˜ æ¨è–¦ è¯äºº 2024 2025")}`; }

        function getAllSpots() {
             let spots = [];
             if (appData && appData.itineraries) {
                 Object.values(appData.itineraries).forEach(day => {
                     if (day.timeline) {
                         day.timeline.forEach(t => spots.push(t.title));
                     }
                 });
             }
             if (appData && appData.shoppingList) {
                 appData.shoppingList.forEach(item => {
                     if (item.location && item.location.trim() !== "") {
                         spots.push(item.location.trim());
                     }
                 });
             }
             return [...new Set(spots)].sort();
        }

        async function fetchExchangeRate() {
            try {
                const res = await fetch('https://api.exchangerate-api.com/v4/latest/JPY');
                const data = await res.json();
                if (data?.rates?.TWD) {
                    appData.config.currencyRate = data.rates.TWD;
                    saveAll(false); 
                    if(currentState.activeTab === 'toolbox' && currentState.activeToolId === 'budget') renderBudget();
                }
            } catch (e) { console.log("Rate API Error, using default"); }
        }

        const appData = {
            config: { 
                currencyRate: 0.22, 
                budgetTWD: 40000, 
                outboundDate: '', 
                outboundNo: '', 
                returnDate: '', 
                returnNo: '', 
                isFlightEditMode: false 
            },
            tabs: [
                { id: 'day1', label: 'D1 é™è½èˆ‡æ–°å®¿', shortLabel: 'D1', type: 'itinerary' },
                { id: 'day2', label: 'D2 æ·ºè‰èˆ‡æ™´ç©º', shortLabel: 'D2', type: 'itinerary' },
                { id: 'day3', label: 'D3 æ½®æµèˆ‡æ¾€è°·', shortLabel: 'D3', type: 'itinerary' },
                { id: 'day4', label: 'D4 éŠ€åº§èˆ‡éµå¡”', shortLabel: 'D4', type: 'itinerary' },
                { id: 'day5', label: 'D5 æ±äº¬è»Šç«™', shortLabel: 'D5', type: 'itinerary' },
                { id: 'toolbox', label: 'æ—…äººå·¥å…·ç®±', shortLabel: 'å·¥å…·ç®±', type: 'container' }
            ],
            tools: [
                { id: 'budget', label: 'é ç®—èˆ‡è¨˜å¸³', icon: 'calculator', desc: 'è¿½è¹¤æ—¥å¹£æ”¯å‡ºèˆ‡å‰©é¤˜é ç®—' },
                { id: 'shopping', label: 'è³¼ç‰©æ¸…å–®', icon: 'shopping-bag', desc: 'ç®¡ç†å¿…è²·ç‰©å“èˆ‡æˆ°åˆ©å“' },
                { id: 'packing', label: 'è¡Œææ¸…å–®', icon: 'briefcase', desc: 'å‡ºç™¼å‰èˆ‡å›ç¨‹æª¢æŸ¥è¡¨' },
                { id: 'phrases', label: 'æŒ‡å·®æœƒè©±', icon: 'message-circle', desc: 'ä¸­æ—¥èªéŸ³ç¿»è­¯èˆ‡æºé€šå¡ç‰‡' }
            ],
            itineraries: {
                day1: {
                    title: "éœ“è™¹å¢æ—ï¼šæ–°å®¿", subtitle: "Arrival / Shinjuku / Kabukicho", intro: "æ±äº¬ï¼Œä¸–ç•Œä¸Šæœ€å¤§çš„å·¨å‹éƒ½å¸‚ã€‚å¾æ©Ÿå ´æ­ä¹˜ç‰¹å¿«åˆ—è»ŠåŠƒéå¹³åŸï¼Œç•¶çª—å¤–çš„å»ºç¯‰é€æ¼¸å¯†é›†ï¼Œæˆ‘å€‘å³å°‡æŠµé”å…¨ä¸–ç•Œæœ€ç¹å¿™çš„è»Šç«™â€”æ–°å®¿ã€‚ä»Šæ™šï¼Œæˆ‘å€‘å°‡è¿·å¤±åœ¨æ­Œèˆä¼ç”ºçš„éœ“è™¹ç‡ˆæµ·èˆ‡æ€å‡ºæ©«ä¸çš„ç‚­ç«ç…™éœ§ä¸­ï¼Œæ„Ÿå—é€™åº§ä¸å¤œåŸçš„è„ˆæã€‚",
                    timeline: [
                        { time: "14:00", title: "æˆç”°/ç¾½ç”°æ©Ÿå ´", tag: "äº¤é€š", ratings:{google:"4.2"}, desc: "ç„¡è«–æ˜¯å¾æˆç”°æ­ä¹˜ N'EX æˆç”°ç‰¹å¿«ï¼Œé‚„æ˜¯å¾ç¾½ç”°æ­ä¹˜å–®è»Œé›»è»Šï¼ŒæŠµé”æ±äº¬å¸‚å€çš„é‚£ä¸€åˆ»éƒ½å……æ»¿å„€å¼æ„Ÿã€‚å»ºè­°å…ˆåœ¨æ©Ÿå ´è³¼è²· Suica (è¥¿ç“œå¡) æˆ– Welcome Suicaï¼Œä¸¦é ˜å–é è¨‚å¥½çš„å‘¨éŠåˆ¸ã€‚æ©Ÿå ´ä¸åƒ…æ˜¯äº¤é€šæ¨ç´ï¼Œä¹Ÿæ˜¯æ‰­è›‹æ©Ÿçš„å¤©å ‚ï¼Œå¯ä»¥åœ¨é€™è£¡å…ˆæ¶ˆè€—æ‰ä¸€äº›é›¶éŒ¢ã€‚", photoTip: "æ‹æ”åˆ—è»Šé€²ç«™çš„ç¬é–“ï¼Œæˆ–æ˜¯é€éè»Šçª—æ‹æ”å¤•é™½ä¸‹çš„æ±äº¬å¤©éš›ç·šå‰ªå½±ã€‚", tips: "å»ºè­°ä½¿ç”¨ Google Maps ç¢ºèªæœ€å¿«è·¯å¾‘ï¼Œæˆç”°æ­ Skyliner æœ€å¿« (40åˆ†)ï¼ŒN'EX ç›´é”æ–°å®¿æ–¹ä¾¿ã€‚", access: "ğŸ§³ å…¥å¢ƒå¾Œè·Ÿéš¨ã€Œéµé“ã€æŒ‡æ¨™ã€‚æˆç”°æ­ N'EX æˆ– Skyliner çš†æœ‰é›»æ¢¯ï¼›ç¾½ç”°å–®è»Œé›»è»Šå…¨ç·šç„¡éšœç¤™ã€‚" },
                        { time: "16:30", title: "æ–°å®¿ Check-in", tag: "ä½å®¿", ratings:{google:"4.0"}, desc: "æ–°å®¿æ˜¯æ±äº¬çš„äº¤é€šå¿ƒè‡Ÿï¼Œé£¯åº—å‘¨é‚Šç¸½æ˜¯ç†±é¬§éå‡¡ã€‚è‘—åçš„ã€Œå“¥å‰æ‹‰é£¯åº—ã€(æ ¼æ‹‰æ–¯éº—æ–°å®¿é…’åº—) å°±åœ¨æ­Œèˆä¼ç”ºä¸­å¿ƒã€‚é€™è£¡æœ‰å·¨å¤§çš„ 3D è²“å’ªçœ‹æ¿ã€å”å‰è¨¶å¾·æ——è‰¦åº—ï¼Œä»¥åŠç„¡æ•¸çš„è—¥å¦åº—ï¼Œæ˜¯è£œè²¨èˆ‡å®‰é “çš„æœ€ä½³åŸºåœ°ã€‚", photoTip: "æ–°å®¿æ±å£è‘—åçš„ 3D è²“å’ªçœ‹æ¿ï¼Œæˆ–æ˜¯å¾é£¯åº—é«˜æ¨“å±¤ä¿¯ç°ç¹å¿™çš„æ–°å®¿è»Šç«™éµè»Œã€‚", tips: "æ–°å®¿è»Šç«™å‡ºå£è¤‡é›œï¼Œè«‹å‹™å¿…è¨˜ä½æ˜¯ã€Œæ±å£ã€ã€ã€Œè¥¿å£ã€é‚„æ˜¯ã€Œå—å£ã€ã€‚", access: "ğŸ“ JRæ–°å®¿ç«™ æ±å£ (æœ‰é›»æ¢¯) / ä¸­å¤®æ±å£ (æœ‰æ‰‹æ‰¶æ¢¯)ã€‚è‹¥ä½æ­Œèˆä¼ç”ºï¼Œèµ°æ±å£å‡ºç«™å¾Œæ²¿è‘—é–åœ‹é€šèµ°æœ€é †ã€‚" },
                        { time: "18:30", title: "æ€å‡ºæ©«ä¸ (å›æ†¶æ©«ä¸)", tag: "ç¾é£Ÿ", ratings:{google:"4.1", tabelog:"3.52"}, desc: "åœ¨ç¾ä»£åŒ–æ‘©å¤©å¤§æ¨“çš„å¤¾ç¸«ä¸­ï¼Œä¿ç•™è‘—ä¸€æ¢å……æ»¿æ˜­å’Œé¢¨æƒ…çš„çª„å··ã€‚é€™è£¡æ›æ»¿äº†ç´…ç‡ˆç± ï¼Œå…©æ—æ˜¯åƒ…èƒ½å®¹ç´æ•¸äººçš„ç‡’çƒ¤å°åº—ã€‚ç©ºæ°£ä¸­ç€°æ¼«è‘—çƒ¤é›è‚‰ä¸² (Yakitori) çš„ç„¦é¦™èˆ‡ç…™éœ§ã€‚é€™è£¡æ˜¯ä¸Šç­æ—ä¸‹ç­å¾Œå–ä¸€æ¯çš„åœ°æ–¹ï¼Œå……æ»¿äº†æ¿ƒåšçš„åº¶æ°‘æ°£æ¯ã€‚éš¨æ„èµ°é€²ä¸€å®¶åº—ï¼Œé»å¹¾ä¸²é›è‚‰ã€ä¸€æ¯ Highballï¼Œé«”é©—æœ€é“åœ°çš„æ±äº¬å±…é…’å±‹æ–‡åŒ–ã€‚", photoTip: "ç«™åœ¨å··å£å¾€å…§æ‹ï¼Œåˆ©ç”¨å£“ç¸®æ„Ÿæ•æ‰å¯†é›†çš„æ‹›ç‰Œã€ç‡ˆç± èˆ‡ç…™éœ§ï¼Œå‘ˆç¾é›»å½±ã€ŠéŠ€ç¿¼æ®ºæ‰‹ã€‹èˆ¬çš„è³½åšé¾å…‹æ„Ÿèˆ‡æ‡·èˆŠæ„Ÿçš„è¡çªã€‚", tips: "æ–°å®¿è¥¿å£æ­¥è¡Œ3åˆ†ï½œå¤§éƒ¨åˆ†åº—å®¶åªæ”¶ç¾é‡‘ï¼Œéƒ¨åˆ†ç„¡ç¦è¸ã€‚", highlights: ["è±šãƒãƒ©ä¸² (è±¬äº”èŠ±ä¸²)", "ãƒ¢ãƒ„ç…®è¾¼ã¿ (ç‡‰ç‰›é›œ)", "ãƒã‚¤ãƒœãƒ¼ãƒ« (Highball è§’å—¨)"], access: "ğŸ“ JRæ–°å®¿ç«™ è¥¿å£ D1 å‡ºå£ (æ¨“æ¢¯) / ğŸ§³ å¸¶è¡Œæè«‹èµ°è¥¿å£åœ°é¢å±¤ (å°ç”°æ€¥ç™¾è²¨æ—)ã€‚" },
                        { time: "20:30", title: "æ­Œèˆä¼ç”ºä¸€ç•ªè¡—", tag: "å¤œéŠ", ratings:{google:"3.9"}, desc: "äºæ´²æœ€å¤§çš„ç´…ç‡ˆå€ï¼Œä¹Ÿæ˜¯æ±äº¬å¤œæ™šæœ€å¼µæšçš„è±¡å¾µã€‚å·¨å¤§çš„ç´…è‰²éœ“è™¹ç‡ˆæ‹±é–€ã€Œæ­Œèˆä¼ç”ºä¸€ç•ªè¡—ã€æ˜¯å¿…æ‹åœ°æ¨™ã€‚é€™è£¡é¾è›‡é›œè™•ï¼Œå……æ»¿äº†èƒ½é‡èˆ‡æ…¾æœ›ã€‚é›–ç„¶å¯ä»¥å®‰å…¨åœ°åƒè§€ä¸»è¡—é“ï¼Œä½†å»ºè­°ä¸è¦è·Ÿéš¨è·¯é‚Šæ‹‰å®¢çš„äººé€²å…¥åº—é‹ªã€‚é€™è£¡ä¹Ÿæ˜¯ã€Šäººä¸­ä¹‹é¾ã€‹éŠæˆ²å ´æ™¯çš„åŸå‹ï¼Œèµ°åœ¨è¡—é ­å½·å½¿ç½®èº«éŠæˆ²ä¸–ç•Œã€‚", photoTip: "å¿…æ‹ç´…è‰²æ‹±é–€æ‹›ç‰Œã€‚åˆ©ç”¨é•·æ›å…‰æ‹æ”è¨ˆç¨‹è»Šæµèˆ‡éœ“è™¹ç‡ˆçš„å…‰è»Œã€‚", tips: "æ–°å®¿æ±å£æ­¥è¡Œ5åˆ†ï½œç´”è§€å…‰æ‹ç…§å³å¯ï¼Œå‹¿éš¨æ„é€²å…¥å…è²»æ¡ˆå…§æ‰€ã€‚", highlights: ["æ‹æ”æ­Œèˆä¼ç”ºä¸€ç•ªè¡—ç´…è‰²æ‹±é–€", "æ¢è¨ªå“¥å‰æ‹‰é ­åƒ (æ ¼æ‹‰æ–¯éº—æ–°å®¿é…’åº—)", "é«”é©—å¤¾å¨ƒå¨ƒæ©Ÿåº— (å¦‚ SEGA/GIGO)", "è§€å¯Ÿæ±æ©«å»£å‘¨é‚Šçš„ç¨ç‰¹ç”Ÿæ…‹", "å°‹æ‰¾éš±è—çš„é»ƒé‡‘è¡— (Golden Gai)"], access: "ğŸ“ JRæ–°å®¿ç«™ æ±å£ / åœ°éµæ–°å®¿ä¸‰ä¸ç›®ç«™ B13 å‡ºå£ (æœ‰é›»æ¢¯)ã€‚" }
                    ]
                },
                day2: {
                    title: "æ±Ÿæˆ¶ä¸‹ç”ºï¼šæ·ºè‰", subtitle: "Asakusa / Skytree / River Cruise", intro: "ç©¿éé›·é–€å·¨å¤§çš„ç´…ç‡ˆç± ï¼Œæˆ‘å€‘å¾ç¾ä»£ç©¿è¶Šå›æ±Ÿæˆ¶æ™‚ä»£ã€‚æ·ºè‰æ˜¯æ±äº¬æœ€å¤è€çš„å¯ºå»Ÿå€ï¼Œå……æ»¿äº†å‚³çµ±å·¥è—èˆ‡ç¾é£Ÿã€‚åˆå¾Œï¼Œæˆ‘å€‘å°‡æ­ä¹˜æœªä¾†æ„Ÿåè¶³çš„æ°´ä¸Šå·´å£«ï¼Œå‰å¾€ä¸–ç•Œæœ€é«˜çš„é›»æ³¢å¡”â€”æ™´ç©ºå¡”ï¼Œè¦‹è­‰æ±äº¬çš„æ–°èˆŠäº¤æ›¿ã€‚",
                    timeline: [
                        { time: "09:00", title: "æ·ºè‰å¯º é›·é–€", tag: "æ–‡åŒ–", ratings:{google:"4.5"}, desc: "æ±äº¬æœ€è‘—åçš„åœ°æ¨™ï¼Œå·¨å¤§çš„ç´…è‰²ç‡ˆç± ä¸Šæ›¸å¯«è‘—ã€Œé›·é–€ã€äºŒå­—ï¼Œå·¦å³è³ç«‹è‘—é¢¨ç¥èˆ‡é›·ç¥åƒã€‚ç©¿éé›·é–€ï¼Œå°±æ˜¯ç†±é¬§çš„ã€Œä»²è¦‹ä¸–é€šã€å•†åº—è¡—ï¼Œè²©è³£è‘—äººå½¢ç‡’ã€ç…é¤…èˆ‡å‚³çµ±æ‰‹å·¥è—å“ã€‚ç›¡é ­çš„è§€éŸ³å ‚é¦™ç«é¼ç››ï¼Œæ“šèªªå°‡é¦™çˆçš„ç…™æ’¥å‘è‡ªå·±èº«é«”ä¸é©çš„éƒ¨ä½å¯ä»¥ç¥ˆæ±‚æ²»ç™’ã€‚é€™è£¡çš„ç©ºæ°£ä¸­æ··åˆè‘—ç·šé¦™èˆ‡çƒ¤é¤…çš„é¦™æ°£ï¼Œæ˜¯é«”é©—æ—¥æœ¬å‚³çµ±ä¿¡ä»°çš„æœ€ä½³å ´æ‰€ã€‚", photoTip: "é›·é–€å¤§ç‡ˆç± åº•éƒ¨æœ‰ç²¾ç·»çš„é¾å½¢é›•åˆ»ï¼Œè¨˜å¾—ç”±ä¸‹å¾€ä¸Šæ‹ã€‚å»ºè­°æ—©èµ·ï¼ˆ8é»å‰ï¼‰é¿é–‹äººæ½®æ‹æ”ç©ºæ™¯ã€‚", tips: "åœ°éµæ·ºè‰ç«™ 1è™Ÿå‡ºå£ï½œä»²è¦‹ä¸–é€šä¸å¯é‚Šèµ°é‚Šåƒï¼Œè«‹åœ¨åº—å®¶æ—å®šé»åƒå®Œã€‚", highlights: ["åœ¨é›·é–€å¤§ç‡ˆç± ä¸‹ç•™å½±", "æ±‚ä¸€æ”¯è§€éŸ³éˆç±¤ (å‰å‡¶çš†æœ‰)", "å°‡é¦™çˆç…™éœ§æ’¥å‘è‡ªå·±ç¥ˆç¦", "å°‹æ‰¾äº”é‡å¡”çš„æœ€ä½³æ‹æ”è§’åº¦", "åœ¨ä»²è¦‹ä¸–é€šåƒç¾çƒ¤äººå½¢ç‡’"], access: "ğŸ“ éŠ€åº§ç·šæ·ºè‰ç«™ 1è™Ÿå‡ºå£ (æ¨“æ¢¯) / ğŸ§³ å¸¶è¡Œæè«‹èµ° 1è™Ÿå‡ºå£æ—é›»æ¢¯ æˆ– éƒ½ç‡Ÿæ·ºè‰ç·š A2b é›»æ¢¯å£ã€‚" },
                        { time: "11:00", title: "æ·ºè‰ç‚¸ç‰›æ’ (ç‰›ã‹ã¤)", tag: "ç¾é£Ÿ", ratings:{google:"4.3"}, desc: "æ·ºè‰åç‰©é™¤äº†å¤©å©¦ç¾…ï¼Œç‚¸ç‰›æ’ä¹Ÿæ˜¯ä¸€çµ•ã€‚å°‡å¤–çš®ç‚¸å¾—é‡‘é»ƒé…¥è„†ï¼Œå…§éƒ¨ä»ä¿æŒé®®ç´…åŠç”Ÿç†Ÿçš„ç‰›æ’ï¼Œåˆ‡æˆè–„ç‰‡å¾Œï¼Œæ”¾åœ¨é¢å‰çš„å°çŸ³æ¿ä¸Šè‡ªè¡Œç…çƒ¤è‡³å–œæ­¡çš„ç†Ÿåº¦ã€‚æ»‹æ»‹ä½œéŸ¿çš„è²éŸ³èˆ‡è‚‰é¦™ä»¤äººé£ŸæŒ‡å¤§å‹•ï¼Œæ­é…å±±è‘µèˆ‡å²©é¹½ï¼Œæ›´èƒ½å¼•å‡ºç‰›è‚‰çš„ç”œå‘³ã€‚", photoTip: "æ‹æ”è‚‰ç‰‡æ–·é¢çš„ç´…è‰²ç´‹ç†ï¼Œä»¥åŠæ”¾åœ¨çŸ³æ¿ä¸Šå†’ç…™çš„ç¬é–“ã€‚", tips: "é›·é–€å°é¢å··å¼„ï½œååº—å¦‚ã€Œæµ…è‰ç‰›ã‹ã¤ã€å¸¸éœ€æ’éšŠï¼Œå»ºè­°é–‹åº—å‰å‰å¾€ã€‚", highlights: ["ç‚¸ç‰›æ’å®šé£Ÿ (ç‰›ã‹ã¤å®šé£Ÿ)", "å±±è‘µ (æ­é…é†¬æ²¹é£Ÿç”¨)", "å²©é¹½ (æ²¾å–å°‘é‡æå‘³)"], access: "ğŸ“ é›·é–€æ­£å°é¢ï¼Œéé¦¬è·¯å¾Œé€²å…¥å··å¼„æ­¥è¡Œç´„ 2 åˆ†é˜ã€‚" },
                        { time: "13:30", title: "éš…ç”°å·æ°´ä¸Šå·´å£«", tag: "é«”é©—", ratings:{google:"4.2"}, desc: "å¾æ·ºè‰å¾å¦»æ©‹æ—çš„ç¢¼é ­å‡ºç™¼ï¼Œæ­ä¹˜ç”±æ¼«ç•«å¤§å¸«æ¾æœ¬é›¶å£«è¨­è¨ˆçš„æœªä¾†å‹æ°´ä¸Šå·´å£«ã€ŒHotalunaã€æˆ–ã€ŒHimikoã€ã€‚èˆ¹èº«å¦‚åŒå¤ªç©ºèˆ¹èˆ¬æµç·šï¼Œæ“æœ‰å·¨å¤§çš„ç»ç’ƒç©¹é ‚ã€‚æ²¿è‘—éš…ç”°å·èˆªè¡Œï¼Œæ²¿é€”å¯ä»¥æ¬£è³å¤šåº§é€ å‹å„ç•°çš„æ©‹æ¨‘ï¼Œä¸¦å¾æ°´é¢ä¸Šä»¥ç¨ç‰¹è¦–è§’ä»°æœ›æ™´ç©ºå¡”èˆ‡æœæ—¥å•¤é…’å¤§æ¨“çš„ã€Œé»ƒé‡‘æ³¡æ²«ã€ã€‚", photoTip: "åœ¨èˆ¹ä¸Šé€éç»ç’ƒç©¹é ‚æ‹æ”å¤©ç©ºèˆ‡æ©‹æ¨‘çš„å¹¾ä½•æ§‹åœ–ã€‚æˆ–æ˜¯åœ¨å¾å¦»æ©‹ä¸Šæ‹æ”èˆ¹éš»èˆ‡æ™´ç©ºå¡”çš„åˆå½±ã€‚", tips: "æ·ºè‰ç¢¼é ­è³¼ç¥¨ï½œå»ºè­°æå‰ä¸Šç¶²é ç´„ Hotaluna ç­æ¬¡ï¼Œå¯ä¸Šç”²æ¿å¹é¢¨ã€‚", highlights: ["æ¬£è³æœæ—¥å•¤é…’å¤§æ¨“çš„ã€Œé»ƒé‡‘æ³¡æ²«ã€", "æ‹æ”ä¸åŒé¡è‰²çš„éš…ç”°å·æ©‹æ¨‘", "åœ¨èˆ¹ä¸Šç”²æ¿æ„Ÿå—æ±Ÿæˆ¶é¢¨æƒ…", "ä»¥ä½è§’åº¦æ‹æ”æ™´ç©ºå¡”å€’å½±", "é«”é©—æ¾æœ¬é›¶å£«è¨­è¨ˆçš„æœªä¾†æ„Ÿèˆ¹è‰™"], access: "ğŸ“ éŠ€åº§ç·šæ·ºè‰ç«™ 4è™Ÿå‡ºå£ (æ¨“æ¢¯) / 5è™Ÿå‡ºå£ (è¼ƒè¿‘)ã€‚ä½æ–¼å¾å¦»æ©‹æ—ç´…è‰²å»ºç¯‰ä¸€æ¨“ã€‚" },
                        { time: "15:00", title: "æ±äº¬æ™´ç©ºå¡”", tag: "æ™¯é»", shoppingCategories:['ä¼´æ‰‹ç¦®','è§’è‰²é€±é‚Š'], ratings:{google:"4.4"}, desc: "é«˜é” 634 å…¬å°ºçš„ä¸–ç•Œæœ€é«˜é›»æ³¢å¡”ã€‚ç™»ä¸Š 350 æ¨“èˆ‡ 450 æ¨“çš„å±•æœ›å°ï¼Œæ•´å€‹é—œæ±å¹³åŸç›¡æ”¶çœ¼åº•ã€‚å¤©æ°£å¥½æ™‚ç”šè‡³èƒ½çœ‹åˆ°å¯Œå£«å±±ã€‚å¡”ä¸‹çš„ã€ŒSolamachiã€è³¼ç‰©ä¸­å¿ƒè¦æ¨¡é¾å¤§ï¼Œæ“æœ‰å¯¶å¯å¤¢ä¸­å¿ƒã€å‰åœåŠ›å•†åº—èˆ‡å„å¼æ±äº¬é™å®šä¼´æ‰‹ç¦®ï¼Œéå¸¸å¥½é€›ã€‚", photoTip: "åœ¨ 450 æ¨“çš„å¤©æœ›è¿´å»Šï¼Œåˆ©ç”¨ç™½è‰²æ–œå¡çµæ§‹å¼•å°è¦–ç·šã€‚å¤•é™½è¥¿ä¸‹æ™‚ï¼ŒåŸå¸‚ç‡ˆå…‰é€æ¼¸äº®èµ·çš„ã€Œé­”å¹»æ™‚åˆ»ã€æœ€ç¾ã€‚", tips: "æŠ¼ä¸Šç«™ç›´çµï½œå»ºè­°è³¼è²·å¤–åœ‹äººå°ˆç”¨ Fast Ticket å¿«é€Ÿé€šé—œã€‚", ticketLink: "https://www.tokyo-skytree.jp/tcn/", highlights: ["ç™»ä¸Š 450M å¤©æœ›è¿´å»Šä¿¯ç°æ±äº¬", "ç«™åœ¨é€æ˜ç»ç’ƒåœ°æ¿ä¸Šè©¦è†½", "æ‹æ”å¤•é™½ä¸‹çš„å¯Œå£«å±±å‰ªå½± (è¦–å¤©æ°£)", "åœ¨ Solamachi è³¼è²·é™å®šç‰ˆæ±äº¬é¦™è•‰", "åƒè§€ 4F çš„æˆ¶å¤–å»£å ´ä»°æœ›å·¨å¡”"], access: "ğŸ“ åŠè—é–€ç·š/æ·ºè‰ç·š æŠ¼ä¸Šç«™ (æ™´ç©ºå¡”å‰) B3 å‡ºå£ç›´çµ (å…¨å€ç„¡éšœç¤™ï¼Œæœ‰å¤§å‹é›»æ¢¯)ã€‚" }
                    ]
                },
                day3: {
                    title: "æ½®æµè–åœ°ï¼šæ¾€è°·", subtitle: "Meiji Jingu / Harajuku / Shibuya Sky", intro: "å¾æ£®æ—èˆ¬çš„æ˜æ²»ç¥å®®å‡ºç™¼ï¼Œæ´—æ»Œå¿ƒéˆå¾Œï¼Œèµ°é€²åŸå®¿çš„å¡å“‡ä¼Šæ–‡åŒ–ï¼Œæœ€å¾Œåœ¨æ¾€è°·é«”é©—ä¸–ç•Œä¸Šæœ€ç¹å¿™çš„åå­—è·¯å£ã€‚é€™æ˜¯ä¸€æ¢å¾æ¥µéœåˆ°æ¥µå‹•ï¼Œå±•ç¾æ±äº¬é’æ˜¥æ´»åŠ›èˆ‡æ½®æµè„ˆå‹•çš„è·¯ç·šã€‚",
                    timeline: [
                        { time: "09:30", title: "æ˜æ²»ç¥å®®", tag: "æ–‡åŒ–", ratings:{google:"4.6"}, desc: "ä½æ–¼åŸå®¿è»Šç«™æ—ï¼Œå»æ“æœ‰å»£é” 70 è¬å¹³æ–¹å…¬å°ºçš„èŒ‚å¯†æ£®æ—ã€‚é€™åº§ä¾›å¥‰æ˜æ²»å¤©çš‡çš„ç¥ç¤¾ï¼Œæ˜¯æ±äº¬å¸‚å€çš„ç¶ è‰²å¿ƒè‡Ÿã€‚èµ°åœ¨ç¢çŸ³åƒé“ä¸Šï¼Œè…³æ­¥è²æ²™æ²™ä½œéŸ¿ï¼Œå·¨å¤§çš„æœ¨è£½é³¥å±…è®“äººæ„Ÿåˆ°èŠåš´å¹³éœã€‚åœ¨é€™è£¡å¯ä»¥çœ‹åˆ°å£¯è§€çš„æ¸…é…’æ¨½ç‰†ï¼Œä¹Ÿæ˜¯èˆ‰è¾¦å‚³çµ±æ—¥å¼å©šç¦®çš„ç†±é–€åœ°é»ï¼Œé‹æ°£å¥½èƒ½çœ‹è¦‹ç©¿è‘—ç™½ç„¡å¢çš„æ–°å¨˜è¡Œåˆ—ã€‚", photoTip: "æ‹æ”å…¥å£è™•å·¨å¤§çš„åŸæœ¨é³¥å±…èˆ‡å…©æ—åƒå¤©å¤æ¨¹çš„å°æ¯”ã€‚æ•´é¢ç»é…’çš„é…’æ¨½ç‰†æ˜¯ç¶“å…¸æ‰“å¡é»ã€‚", tips: "JRåŸå®¿ç«™ è¥¿å£ï½œé€²å…¥æœ¬æ®¿å‰è«‹åœ¨æ‰‹æ°´èˆæ´—æ‰‹æ¼±å£ã€‚", highlights: ["æ¼«æ­¥åœ¨å·¨å¤§çš„ç¢çŸ³åƒé“", "åœ¨åŸæœ¨å¤§é³¥å±…å‰é èº¬", "æ‹æ”å£¯è§€çš„æ¸…é…’æ¨½ç‰†", "å¯«ä¸€å¡Šç¥ˆé¡˜ç¹ªé¦¬", "å°‹æ‰¾å¤«å©¦æ¥ ç¥ˆæ±‚è‰¯ç·£"], access: "ğŸ“ JRåŸå®¿ç«™ è¥¿å£ (æœ‰é›»æ¢¯) / åœ°éµæ˜æ²»ç¥å®®å‰ç«™ 2è™Ÿå‡ºå£ (æœ‰é›»æ¢¯)ã€‚" },
                        { time: "11:30", title: "åŸå®¿ ç«¹ä¸‹é€š", tag: "è³¼ç‰©", shoppingCategories:['æœé£¾','é›œè²¨'], ratings:{google:"4.0"}, desc: "æ—¥æœ¬ã€Œå¡å“‡ä¼Šã€(Kawaii) æ–‡åŒ–çš„ç™¼æºåœ°ã€‚é€™æ¢ç‹¹çª„çš„è¡—é“æ“ æ»¿äº†è²©è³£å¯éº—é¤…ã€å½©è‰²æ£‰èŠ±ç³–ã€å¶åƒå‘¨é‚Šèˆ‡å¹³åƒ¹æ½®æµæœé£¾çš„åº—é‹ªã€‚é€™è£¡æ˜¯é«˜ä¸­ç”Ÿçš„è–åœ°ï¼Œå……æ»¿äº†ç²‰ç´…è‰²çš„èƒ½é‡èˆ‡èª‡å¼µçš„è¦–è¦ºè¡æ“Šã€‚å³ä¾¿ä¸è²·æ±è¥¿ï¼Œå…‰æ˜¯è§€å¯Ÿè·¯äººçš„ç©¿è‘—å°±æ˜¯ä¸€ç¨®æ¨‚è¶£ã€‚", photoTip: "å…¥å£è™•çš„ã€ŒTakeshita Streetã€æ°£çƒæ‹±é–€ã€‚æ‰‹æŒè‰²å½©ç¹½ç´›çš„å¯éº—é¤…èˆ‡èƒŒæ™¯çš„äººæ½®åˆç…§ã€‚", tips: "JRåŸå®¿ç«™ ç«¹ä¸‹å£ï½œäººæ½®æ¥µå…¶æ“æ“ ï¼Œè«‹æ³¨æ„éš¨èº«è²¡ç‰©ã€‚", highlights: ["å“åšè¶…å¤§å½©è™¹æ£‰èŠ±ç³–æˆ–å¯éº—é¤…", "æ‹ä¸€å¼µæœ€æ–°çš„æ—¥å¼æ‹è²¼æ©Ÿ", "é€›å¤§å‰µ (DAISO) æ——è‰¦åº—", "è§€å¯ŸåŸå®¿ç³»ç©¿æ­çš„è·¯äºº", "åœ¨å…¥å£æ‹±é–€è™•æ‰“å¡"], access: "ğŸ“ JRåŸå®¿ç«™ ç«¹ä¸‹å£ (åƒ…æ¨“æ¢¯/æ–œå¡) / ğŸ§³ å¸¶è¡Œæå»ºè­°èµ°è¡¨åƒé“å£ (æœ‰é›»æ¢¯) å†ç¹å›ã€‚" },
                        { time: "15:00", title: "æ¾€è°·åå­—è·¯å£", tag: "åœ°æ¨™", ratings:{google:"4.4"}, desc: "è¢«ç¨±ç‚ºã€Œä¸–ç•Œæœ€ç¹å¿™çš„åå­—è·¯å£ã€ï¼Œæ¯æ¬¡ç¶ ç‡ˆäº®èµ·ï¼ŒåŒæ™‚æœ‰é«˜é” 3000 äººç©¿è¶Šé¦¬è·¯ï¼Œå»èƒ½å¥‡è¹Ÿèˆ¬åœ°äº’ä¸ç¢°æ’ã€‚å‘¨åœè¢«å·¨å¤§çš„è¢å¹•èˆ‡å»£å‘Šçœ‹æ¿åŒ…åœï¼Œé€™è£¡å°±æ˜¯æ±äº¬æ··äº‚èˆ‡ç§©åºä¸¦å­˜çš„æ¥µè‡´å±•ç¾ã€‚è‘—åçš„ã€Œå¿ çŠ¬å…«å…¬åƒã€å°±åœ¨è»Šç«™å‡ºå£ï¼Œæ˜¯ç†±é–€çš„æœƒé¢é»ã€‚", photoTip: "æœ€ä½³æ‹æ”é»æ˜¯æ˜Ÿå·´å…‹(TSUTAYAæ¨“ä¸Š)çš„çª—é‚Šï¼Œæˆ–æ˜¯ MAGNET by SHIBUYA109 çš„é ‚æ¨“å±•æœ›å°ï¼Œå¯æ‹æ”ç¸®æ™‚æ”å½±ç´€éŒ„äººæµã€‚", tips: "JRæ¾€è°·ç«™ å…«å…¬å£ï½œæƒ³æ‹å…«å…¬åƒè¦æœ‰æ’éšŠçš„å¿ƒç†æº–å‚™ã€‚", highlights: ["åœ¨ç¶ ç‡ˆæ™‚é«”é©—ã€Œäººæµ·ç©¿è¶Šã€", "å¾æ˜Ÿå·´å…‹äºŒæ¨“æ‹æ”åå­—è·¯å£å…¨æ™¯", "èˆ‡å¿ çŠ¬å…«å…¬åƒåˆå½±", "è§€çœ‹å·¨å¤§çš„æˆ¶å¤–å»£å‘Šè¢å¹•", "å°‹æ‰¾ã€Šä»Šéš›ä¹‹åœ‹ã€‹çš„æ—¢è¦–æ„Ÿ"], access: "ğŸ“ JRæ¾€è°·ç«™ å…«å…¬å£ (äººå¤š) / åœ°éµ A8 å‡ºå£ (æœ‰é›»æ¢¯ï¼Œç›´é€šåœ°é¢)ã€‚" },
                        { time: "17:00", title: "SHIBUYA SKY", tag: "æ™¯é»", ratings:{google:"4.5"}, desc: "è¿‘å¹´æ±äº¬æœ€ç†±é–€çš„æ™¯é»ï¼Œä½æ–¼æ¾€è°· Scramble Square é ‚æ¨“çš„éœ²å¤©å±•æœ›å°ã€‚æ“æœ‰ 360 åº¦ç„¡æ­»è§’çš„ç»ç’ƒåœæ¬„ï¼Œå½·å½¿æ¼‚æµ®åœ¨æ±äº¬ä¸Šç©ºã€‚é€™è£¡å¯ä»¥åŒæ™‚ä¿¯ç°æ¾€è°·åå­—è·¯å£ã€æ±äº¬éµå¡”èˆ‡ä»£ä»£æœ¨å…¬åœ’ã€‚è§’è½çš„ç»ç’ƒè§’æ˜¯æ‹æ”ã€Œæ‡¸æµ®ç…§ã€çš„å…µå®¶å¿…çˆ­ä¹‹åœ°ã€‚", photoTip: "ä¸€å®šè¦é ç´„æ—¥è½å‰ä¸€å°æ™‚å…¥å ´ï¼Œå¾å¤•é™½æ‹åˆ°å¤œæ™¯ã€‚ç»ç’ƒè§’çš„å€’å½±æ˜¯å¿…æ‹æ§‹åœ–ã€‚", tips: "æ¾€è°·ç«™ç›´çµï½œé–€ç¥¨éå¸¸æ¶æ‰‹ï¼Œå‹™å¿…æå‰ä¸€å€‹æœˆå®˜ç¶²é ç´„ã€‚", ticketLink: "https://www.shibuya-scramble-square.com/sky/ticket/", highlights: ["æ­ä¹˜å……æ»¿æœªä¾†æ„Ÿçš„é›»æ‰¶æ¢¯", "åœ¨ã€ŒSKY EDGEã€è§’è½æ‹æ”æ‡¸æµ®ç…§", "èººåœ¨ç¶²åºŠä¸Šä»°æœ›å¤©ç©º", "æ¬£è³ 360 åº¦ç„¡æ­»è§’æ±äº¬å¤œæ™¯", "æ‹æ”æ¾€è°· Scramble Square çš„ç»ç’ƒå€’å½±"], access: "ğŸ“ æ¾€è°· Scramble Square 1F/B2 çš†æœ‰ç›´é”é›»æ¢¯ / JR æ¾€è°·ç«™ ä¸­å¤®æ”¹æœ­ å‡ºä¾†å³æ˜¯ã€‚" }
                    ]
                },
                day4: {
                    title: "å¤§äººå¥¢è¯ï¼šéŠ€åº§", subtitle: "Tsukiji / Ginza / Tokyo Tower", intro: "ä»Šå¤©èµ°å…¥å¤§äººçš„æ±äº¬ã€‚æ—©æ™¨åœ¨ç¯‰åœ°å“åšæ–°é®®æµ·é®®ï¼Œåˆå¾Œæ¼«æ­¥åœ¨å¥¢è¯çš„éŠ€åº§è¡—é ­ï¼Œæ„Ÿå—ç²¾å“å»ºç¯‰ä¹‹ç¾ã€‚å¤œæ™šç™»ä¸Šç¶“å…¸çš„æ±äº¬éµå¡”ï¼Œåœ¨æ©˜ç´…è‰²çš„ç‡ˆå…‰ä¸‹æ„Ÿå—æ˜­å’Œæµªæ¼«ã€‚",
                    timeline: [
                        { time: "08:30", title: "ç¯‰åœ°å ´å¤–å¸‚å ´", tag: "ç¾é£Ÿ", shoppingCategories:['ä¹¾è²¨','å»šå…·'], ratings:{google:"4.2"}, desc: "é›–ç„¶æ‰¹ç™¼å¸‚å ´å·²æ¬é·è‡³è±æ´²ï¼Œä½†ç¯‰åœ°å ´å¤–å¸‚å ´ä¾ç„¶ä¿ç•™äº†ç†±é¬§çš„å¸‚é›†æ°›åœã€‚é€™è£¡æœ‰æœ€æ–°é®®çš„å£½å¸ã€æµ·é®®ä¸¼ã€å‰›å‡ºçˆçš„ç‰å­ç‡’èˆ‡å„å¼ä¹¾è²¨ã€‚çª„å··ä¸­æ“ æ»¿äº†å°‹æ‰¾ç¾é£Ÿçš„é¥•å®¢ã€‚å¿…åƒé …ç›®åŒ…æ‹¬ã€Œæ¾éœ²ç‰å­ç‡’ã€ã€ã€Œç‹ç‹¸å±‹ç‰›ä¸¼ã€(å¦‚æœä¸æ€•æ’éšŠèˆ‡è€é—†å€‹æ€§) ä»¥åŠè·¯é‚Šçš„çƒ¤æ‰‡è²èˆ‡ç”Ÿè ”ã€‚", photoTip: "ç‰¹å¯«å‰›å‡ºçˆå†’è‘—ç†±æ°£çš„ç‰å­ç‡’ã€‚æ‹æ”å¸«å‚…ç‚™ç‡’æµ·é®®çš„å°ˆæ³¨ç¥æƒ…ã€‚", tips: "åœ°éµç¯‰åœ°å¸‚å ´ç«™ï½œå¤šæ•¸åº—å®¶åªæ”¶ç¾é‡‘ï¼Œå»ºè­°æ—©æ™¨å‰å¾€ï¼Œä¸­åˆéå¾Œè¨±å¤šåº—å®¶æœƒæ‰“çƒŠã€‚", highlights: ["æ¾éœ²ç‰å­ç‡’ (ç†±å‘¼å‘¼ç¾åƒ)", "ç‹ç‹¸å±‹ç‰›ä¸¼ (ãƒ›ãƒ«ãƒ¢ãƒ³ä¸¼)", "æ–°é®®ç”Ÿè ”æˆ–çƒ¤æ‰‡è²"], access: "ğŸ“ å¤§æ±Ÿæˆ¶ç·š ç¯‰åœ°å¸‚å ´ç«™ A1 å‡ºå£ (æœ‰é›»æ¢¯) / æ—¥æ¯”è°·ç·š ç¯‰åœ°ç«™ 1è™Ÿå‡ºå£ (æœ‰é›»æ¢¯)ã€‚" },
                        { time: "11:00", title: "éŠ€åº§ æ­¥è¡Œè€…å¤©åœ‹", tag: "è³¼ç‰©", shoppingCategories:['ç²¾å“','æ–‡å…·','ç¾å¦'], ratings:{google:"4.4"}, desc: "æ—¥æœ¬æœ€æ˜‚è²´çš„åœ°æ®µï¼ŒåŒ¯é›†äº†å…¨çƒé ‚ç´šç²¾å“æ——è‰¦åº—ã€‚é€™è£¡çš„å»ºç¯‰æœ¬èº«å°±æ˜¯è—è¡“å“ï¼Œå¦‚ HermÃ¨s çš„ç»ç’ƒç£šå¤§æ¨“ã€Louis Vuitton çš„æ°´æ³¢ç´‹å¤–ç‰†ã€‚é€±æœ«ä¸‹åˆä¸­å¤®é€šæœƒå°è·¯æˆç‚ºã€Œæ­¥è¡Œè€…å¤©åœ‹ã€ï¼Œå¯ä»¥å¤§æ–å¤§æ“ºåœ°èµ°åœ¨é¦¬è·¯ä¸­é–“æ‹ç…§ã€‚å¿…é€›é‚„æœ‰æ–‡å…·æ§çš„å¤©å ‚ã€Œä¼Šæ±å±‹ã€(Itoya) èˆ‡å¹³åƒ¹æœé£¾æ——è‰¦åº— Uniqlo/GUã€‚", photoTip: "åœ¨æ­¥è¡Œè€…å¤©åœ‹æ™‚ï¼Œååœ¨é¦¬è·¯ä¸­å¤®(éœ€æ³¨æ„ç¦®å„€)åˆ©ç”¨é€è¦–æ„Ÿæ‹æ”è¡—é“å…©æ—çš„ç²¾å“å¤§æ¨“ã€‚ä¼Šæ±å±‹çš„é‡èœå·¥å» ä¹Ÿæ˜¯ç‰¹æ®Šå–æ™¯é»ã€‚", tips: "åœ°éµéŠ€åº§ç«™ï½œæ­¥è¡Œè€…å¤©åœ‹æ™‚é–“ï¼šé€±æœ«/å‡æ—¥ 12:00-18:00 (å†¬å­£è‡³17:00)ã€‚", highlights: ["åœ¨é¦¬è·¯æ­£ä¸­å¤®æ‹ç…§ (é™é€±æœ«)", "åƒè§€ GINZA SIX çš„è‰é–“å½Œç”Ÿè£ç½®è—è¡“", "é€› 12 å±¤æ¨“çš„ UNIQLO æ——è‰¦åº—", "æ¬£è³è³‡ç”Ÿå ‚ç´…æ¨“èˆ‡å„å¤§ç²¾å“å»ºç¯‰å¤–è§€", "åˆ°ä¼Šæ±å±‹ (Itoya) æŒ‘é¸ç²¾ç·»æ–‡å…·"], access: "ğŸ“ éŠ€åº§ç«™ A8 (ä¸‰è¶Š) æˆ– A12 (æ¾å±‹) å‡ºå£æœ‰é›»æ¢¯ï¼Œç›´é€šåœ°é¢ã€‚" },
                        { time: "15:00", title: "teamLab Planets", tag: "è—è¡“", ratings:{google:"4.6"}, desc: "ä½æ–¼è±æ´²çš„æ²‰æµ¸å¼æ•¸ä½è—è¡“å±•ã€‚ä¸»æ‰“ã€Œèº«æ­·å…¶å¢ƒã€ï¼Œåƒè§€è€…éœ€è¦è„«é‹èµ¤è…³é€²å…¥æ°´ä¸­ï¼Œæ„Ÿå—å…‰å½±ã€æ°´æµèˆ‡èŠ±æœµåœ¨èº«é‚Šæµå‹•ã€‚å·¨å¤§çš„æ°´æ™¶å®‡å®™ã€æ¼‚æµ®çš„èŠ±åœ’ï¼Œè®“äººåˆ†ä¸æ¸…è™›æ“¬èˆ‡ç¾å¯¦çš„é‚Šç•Œã€‚é€™æ˜¯ä¸€å€‹æ¥µåº¦é©åˆæ‹ç…§ï¼ŒåŒæ™‚ä¹Ÿèƒ½ç”¨èº«é«”æ„Ÿå®˜é«”é©—è—è¡“çš„ç¨ç‰¹ç©ºé–“ã€‚", photoTip: "æ°´æ™¶å®‡å®™åˆ©ç”¨é¡é¢åå°„æ‹æ”ç„¡é™å»¶ä¼¸æ„Ÿã€‚åœ¨æ°´ä¸­å±•å€éœ€æ³¨æ„è¤²ç®¡å¯æ²èµ·ï¼Œå»ºè­°ç©¿è‘—çŸ­è¤²æˆ–æ˜“æ²çš„è¤²å­ã€‚", tips: "ç™¾åˆæµ·é·—è™Ÿ æ–°è±æ´²ç«™ï½œéœ€äº‹å…ˆè³¼ç¥¨æŒ‡å®šå…¥å ´æ™‚é–“ã€‚", ticketLink: "https://planets.teamlab.art/tokyo/tw/", highlights: ["åœ¨ã€Œæ°´æ™¶å®‡å®™ã€æ‹æ”ç„¡é™å»¶ä¼¸çš„å…‰é»", "èµ¤è…³æ„Ÿå—ã€ŒéŒ¦é¯‰èˆ‡æ°´é¢ã€çš„äº’å‹•", "åœ¨ã€Œæ¼‚æµ®èŠ±åœ’ã€èˆ‡è˜­èŠ±åˆå½±", "é«”é©—æŸ”è»Ÿçš„ã€Œé»‘æ´ã€æ‡¶éª¨é ­å€", "èººåœ¨ã€Œå¹»èŠ±äº­ã€çœ‹å¤©èŠ±æ¿èŠ±æœµé£„è½"], access: "ğŸ“ ç™¾åˆæµ·é·—è™Ÿ æ–°è±æ´²ç«™ (å‡ºç«™æ­¥è¡Œ 1 åˆ†é˜ï¼Œå…¨ç·šæœ‰é›»æ¢¯)ã€‚" },
                        { time: "19:00", title: "æ±äº¬éµå¡”", tag: "åœ°æ¨™", ratings:{google:"4.5"}, desc: "ç´…ç™½ç›¸é–“çš„æ±äº¬éµå¡”ï¼Œæ°¸é æ˜¯æ±äº¬æœ€æº«æš–çš„è±¡å¾µã€‚èˆ‡æ™´ç©ºå¡”çš„ç§‘æŠ€æ„Ÿä¸åŒï¼Œæ±äº¬éµå¡”æ•£ç™¼è‘—ä¸€ç¨®å¾©å¤çš„æµªæ¼«ã€‚å¯ä»¥é¸æ“‡ç™»ä¸Šå±•æœ›å°ï¼Œæˆ–è€…åœ¨å¢ä¸Šå¯ºæ—æ‹æ”éµå¡”å…¨æ™¯ã€‚é™„è¿‘çš„ã€ŒèŠå…¬åœ’ã€æ˜¯é‡é¤ä¸¦æ¬£è³éµå¡”å¤œæ™¯çš„çµ•ä½³åœ°é»ã€‚æ¯æ™šçš„é»ç‡ˆé¡è‰²æœƒéš¨å­£ç¯€èˆ‡æ´»å‹•è®ŠåŒ–ã€‚", photoTip: "è‘—åçš„ã€Œåœ°ä¸‹åœè»Šå ´éšæ¢¯ã€ç”±ä¸‹å¾€ä¸Šæ‹(éœ€æ’éšŠ)ã€‚æˆ–æ˜¯å¾èŠå…¬åœ’çš„è‰åœ°ä¸Šæ‹æ”éµå¡”èˆ‡äººçš„åˆå½±ã€‚", tips: "åœ°éµèµ¤ç¾½æ©‹ç«™ï½œTop Deck Tour éœ€é ç´„ã€‚", highlights: ["ç”±ä¸‹å¾€ä¸Šæ‹æ”è‘—åçš„ã€Œåœ°ä¸‹åœè»Šå ´éšæ¢¯ã€", "åœ¨å¢ä¸Šå¯ºæ‹æ”å¯ºå»Ÿèˆ‡éµå¡”çš„åŒæ¡†", "ç™»ä¸Š Top Deck æ„Ÿå—å¹¾ä½•é¡é¢è¨­è¨ˆ", "è¸©åœ¨ Lookdown Window ä¿¯ç°åœ°é¢", "è³¼è²·æ±äº¬éµå¡”å½¢ç‹€çš„ç¤¦æ³‰æ°´"], access: "ğŸ“ å¤§æ±Ÿæˆ¶ç·š èµ¤ç¾½æ©‹ç«™ èµ¤ç¾½æ©‹å£ (æœ‰é›»æ¢¯)ã€‚" }
                    ]
                },
                day5: {
                    title: "çµ‚ç« ï¼šæ±äº¬è»Šç«™", subtitle: "Tokyo Station / Character St. / Airport", intro: "æ—…ç¨‹çš„æœ€å¾Œï¼Œæˆ‘å€‘ä¾†åˆ°æ±äº¬çš„ç„é—œâ€”æ±äº¬è»Šç«™ã€‚æ¬£è³é€™åº§ç™¾å¹´å‰çš„ç´…ç£šå»ºç¯‰ï¼Œåœ¨ä¸€ç•ªè¡—æœ€å¾Œä¸€æ¬¡æƒè²¨ï¼Œå¸¶è‘—æ»¿æ»¿çš„æˆ°åˆ©å“èˆ‡å›æ†¶ï¼Œæ­ä¸Šåˆ—è»Šå‰å¾€æ©Ÿå ´ã€‚",
                    timeline: [
                        { time: "10:00", title: "æ±äº¬è»Šç«™ ä¸¸ä¹‹å…§", tag: "å»ºç¯‰", shoppingCategories:['ä¼´æ‰‹ç¦®'], ratings:{google:"4.5"}, desc: "é€™åº§å¾©å¤çš„ç´…ç£šå»ºç¯‰æ˜¯æ±äº¬çš„è±¡å¾µä¹‹ä¸€ã€‚ä¸¸ä¹‹å…§å´çš„åœ“é ‚å…§éƒ¨è£é£¾æ¥µç‚ºè¯éº—ï¼Œæœ‰è‘—ç²¾ç·»çš„æµ®é›•èˆ‡éµé»ƒè‰²èª¿ã€‚èµ°å‡ºè»Šç«™ï¼Œç«™å‰å»£å ´å¯¬æ•æ°£æ´¾ï¼Œå¯ä»¥æ‹æ”è»Šç«™å…¨æ™¯ã€‚é€™é™„è¿‘ä¹Ÿæ˜¯çš‡å±…çš„å…¥å£ï¼Œæœ‰æ™‚é–“å¯ä»¥æ•£æ­¥è‡³äºŒé‡æ©‹ã€‚", photoTip: "ç«™å‰å»£å ´å¯ä»¥æ‹åˆ°å®Œæ•´çš„ç´…ç£šç«™é«”å€’å½±(é›¨å¾Œæ›´ä½³)ã€‚åœ“é ‚å…§éƒ¨çš„å¤©èŠ±æ¿æµ®é›•éœ€ä½¿ç”¨å»£è§’é¡é ­ä»°æ‹ã€‚", tips: "JRæ±äº¬ç«™ ä¸¸ä¹‹å…§åŒ—å£/å—å£", highlights: ["ä»°æ‹ä¸¸ä¹‹å…§åŒ—å£/å—å£çš„å…«è§’å½¢åœ“é ‚", "åœ¨ç«™å‰å»£å ´æ‹æ”è»Šç«™å…¨æ™¯èˆ‡å€’å½±", "å°‹æ‰¾éš±è—åœ¨ç´…ç£šç‰†ä¸Šçš„æ„›å¿ƒç£š", "åƒè§€è»Šç«™å…§çš„æ±äº¬ Station Gallery", "æ¬£è³çš‡å±…æ–¹å‘çš„éŠ€æå¤§é“"], access: "ğŸ“ JR ä¸¸ä¹‹å…§åŒ—å£/å—å£çš†ä½æ–¼åœ°é¢å±¤ï¼Œç„¡éšœç¤™ã€‚è‹¥å¾åœ°ä¸‹è¡—ä¸Šä¾†è«‹æ‰¾ã€Œä¸¸ä¹‹å…§ã€æ–¹å‘é›»æ¢¯ã€‚" },
                        { time: "11:30", title: "æ±äº¬ä¸€ç•ªè¡—", tag: "è³¼ç‰©", shoppingCategories:['è§’è‰²é€±é‚Š','æ‹‰éºµ'], ratings:{google:"4.3"}, desc: "ä½æ–¼æ±äº¬è»Šç«™å…«é‡æ´²å£åœ°ä¸‹ï¼Œæ˜¯å‹•æ¼«è¿·èˆ‡ç¾é£Ÿå®¶çš„æœ€å¾Œä¸€ç«™ã€‚ã€Œæ±äº¬å‹•æ¼«äººç‰©è¡—ã€é›†åˆäº†å¯¶å¯å¤¢ã€å‰åœåŠ›ã€Jump Shop ç­‰å„å¤§ IP å°ˆè³£åº—ã€‚ã€Œæ±äº¬æ‹‰éºµè¡—ã€å‰‡åŒ¯é›†äº†å…­å˜èˆç­‰ååº—ã€‚æ­¤å¤–ï¼Œé€™è£¡ä¹Ÿæ˜¯è³¼è²·ä¼´æ‰‹ç¦®çš„ä¸€ç´šæˆ°å€ï¼Œè‘—åçš„ NY Perfect Cheeseã€æ±äº¬é¦™è•‰éƒ½å¯ä»¥åœ¨é€™è£¡è²·é½Šã€‚", photoTip: "å„å€‹è§’è‰²å°ˆè³£åº—çš„å·¨å¤§å…¬ä»”ã€‚æ‹‰éºµè¡—æ’éšŠçš„äººæ½®ã€‚", tips: "JRæ±äº¬ç«™ å…«é‡æ´²åœ°ä¸‹ä¸­å¤®å£ï½œå¤§ä¸¸ç™¾è²¨ä¹Ÿåœ¨é™„è¿‘ï¼Œå¯é€€ç¨…ã€‚", highlights: ["åœ¨æ‹‰éºµè¡—å“åšå…­å˜èˆæ²¾éºµ", "é€›å¯¶å¯å¤¢ä¸­å¿ƒ (Pokemon Store)", "è³¼è²· Calbee ç¾ç‚¸è–¯æ¢", "æ”¶é›†å„å¤§é›»è¦–å°çš„è§’è‰²é€±é‚Š", "å°‹æ‰¾é™å®šç‰ˆçš„æ±äº¬é¦™è•‰å£å‘³"], access: "ğŸ“ å…«é‡æ´²åœ°ä¸‹ä¸­å¤®å£ (ç›´çµ)ã€‚è‹¥å¾åœ°é¢é€²å…¥ï¼Œè«‹èµ°ã€Œå…«é‡æ´²ä¸­å¤®å£ã€æ‰‹æ‰¶æ¢¯ä¸‹æ¨“ã€‚" },
                        { time: "15:00", title: "å‰å¾€æ©Ÿå ´", tag: "å›ç¨‹", ratings:{google:"4.0"}, desc: "å¸¶è‘—ä¾ä¾ä¸æ¨çš„å¿ƒæƒ…èˆ‡å¡æ»¿çš„è¡Œæç®±ï¼Œæ­ä¹˜ N'EX æˆ–å·´å£«å‰å¾€æ©Ÿå ´ã€‚å¦‚æœæ™‚é–“å……è£•ï¼Œæˆç”°æ©Ÿå ´èˆ‡ç¾½ç”°æ©Ÿå ´çš„æ±Ÿæˆ¶å°è·¯/æ—¥æœ¬æ©‹ä¹Ÿæ˜¯æœ€å¾Œæ‹ç…§èˆ‡ç”¨é¤çš„å¥½åœ°æ–¹ã€‚åˆ¥å¿˜äº†åœ¨å…¥é—œå¾Œçš„å…ç¨…åº—è£œé½Šæœ€å¾Œçš„è–¯æ¢ä¸‰å…„å¼Ÿèˆ‡ç™½è‰²æˆ€äººã€‚", photoTip: "æ©Ÿå ´å‡ºç™¼å¤§å»³çš„èˆªç­é¡¯ç¤ºæ¿ï¼Œè±¡å¾µæ—…ç¨‹çš„çµæŸèˆ‡ä¸‹ä¸€æ¬¡çš„é–‹å§‹ã€‚", tips: "è«‹é ç•™è‡³å°‘ 3 å°æ™‚æŠµé”æ©Ÿå ´è¾¦ç†ç™»æ©Ÿèˆ‡é€€ç¨…æ‰‹çºŒã€‚", access: "ğŸ§³ æ±äº¬ç«™æ­ä¹˜ N'EX è«‹è‡³ã€Œä¸¸ä¹‹å…§åœ°ä¸‹ã€æœˆå° (æœ‰å°ˆç”¨é›»æ¢¯)ï¼›å·´å£«è«‹è‡³å…«é‡æ´²å—å£ã€‚" }
                    ]
                }
            },
            // --- 20ç­† æ±äº¬è³¼ç‰©æ¸…å–® ---
            shoppingList: [
                { id: 's1', category: 'ä¼´æ‰‹ç¦®', recipient: 'åŒäº‹', item: 'NY Perfect Cheese (12å…¥)', location: 'æ±äº¬è»Šç«™ ä¸¸ä¹‹å…§', note: 'æ±äº¬è»Šç«™å¿…è²·ï¼Œéœ€æ—©èµ·', checked: false },
                { id: 's2', category: 'ä¼´æ‰‹ç¦®', recipient: 'å®¶äºº', item: 'æ±äº¬é¦™è•‰ (æµ·çºå’–å•¡ç‰›å¥¶å‘³)', location: 'æ±äº¬ä¸€ç•ªè¡—', note: 'ç¶“å…¸æ¬¾æˆ–é™å®šæ¬¾', checked: false },
                { id: 's3', category: 'ä¼´æ‰‹ç¦®', recipient: 'æœ‹å‹', item: 'Press Butter Sand (ç„¦ç³–)', location: 'æ±äº¬æ™´ç©ºå¡”', note: 'æ™´ç©ºå¡”æœ‰è³£', checked: false },
                { id: 's4', category: 'ä¼´æ‰‹ç¦®', recipient: 'è‡ªå·±', item: 'Sugar Butter Sand Tree', note: '7-11ä¹Ÿæœ‰å¹³åƒ¹ç‰ˆ', checked: false },
                { id: 's5', category: 'è—¥å¦', recipient: 'åª½åª½', item: 'åˆåˆ©ä»–å‘½ EX Plus (270éŒ )', note: 'ä¸Šé‡OS Drugè¼ƒä¾¿å®œ', checked: false },
                { id: 's6', category: 'è—¥å¦', recipient: 'è‡ªå·±', item: 'EVE Quick é ­ç—›è—¥ (è—è‰²)', note: 'åŠ å¼·ç‰ˆ', checked: false },
                { id: 's7', category: 'ç”Ÿæ´»é›œè²¨', recipient: 'è‡ªå·±', item: 'Standard Products é¤å…·', location: 'æ¾€è°·åå­—è·¯å£', note: 'æ¸‹è°·åº—å¾ˆå¤§', checked: false },
                { id: 's8', category: 'æœé£¾', recipient: 'å¦¹å¦¹', item: 'Uniqlo éŠ€åº§æ——è‰¦åº—é™å®šT', location: 'éŠ€åº§ æ­¥è¡Œè€…å¤©åœ‹', note: '12æ¨“å°ˆå€', checked: false },
                { id: 's9', category: 'è§’è‰²é€±é‚Š', recipient: 'å¼Ÿå¼Ÿ', item: 'å¯¶å¯å¤¢ä¸­å¿ƒ é™å®šçš®å¡ä¸˜', location: 'SHIBUYA SKY', note: 'æ¾€è°·/æ™´ç©ºå¡”/æ±äº¬ç«™', checked: false },
                { id: 's10', category: 'æ–‡å…·', recipient: 'è‡ªå·±', item: 'ä¼Šæ±å±‹ é‹¼ç­†', location: 'éŠ€åº§ æ­¥è¡Œè€…å¤©åœ‹', note: 'éŠ€åº§æœ¬åº—', checked: false },
                { id: 's11', category: 'ç¾å¦', recipient: 'å§Šå§Š', item: '&be é®ç‘•è†', note: 'Loft/Plazaæœ‰è³£', checked: false },
                { id: 's12', category: 'é›¶é£Ÿ', recipient: 'è‡ªå·±', item: 'Calbee ç¾ç‚¸è–¯æ¢', location: 'åŸå®¿ ç«¹ä¸‹é€š', note: 'åŸå®¿åº—', checked: false },
                { id: 's13', category: 'ç”Ÿæ´»é›œè²¨', recipient: 'æœ‹å‹', item: 'Starbucks æ¾€è°·é™å®šæ¯', location: 'æ¾€è°·åå­—è·¯å£', note: 'å…«å…¬åœ–æ¡ˆ', checked: false },
                { id: 's14', category: 'é›»å™¨', recipient: 'çˆ¸çˆ¸', item: 'Panasonic åˆ®é¬åˆ€', note: 'Bic Camera', checked: false },
                { id: 's15', category: 'æ–‡åŒ–', recipient: 'è‡ªå·±', item: 'æ·ºè‰å¯º å¾¡å®ˆ', location: 'æ·ºè‰å¯º é›·é–€', note: 'é›·é–€é€ å‹', checked: false },
                { id: 's16', category: 'ä¼´æ‰‹ç¦®', recipient: 'è¦ªæˆš', item: 'Yoku Moku é›ªèŒ„è›‹æ²', note: 'é’å±±æœ¬åº—æˆ–ç™¾è²¨', checked: false },
                { id: 's17', category: 'æœé£¾', recipient: 'è‡ªå·±', item: 'GU å¯¬è¤²', note: 'æ—¥æœ¬æ¬¾æ¨£å¼å¤š', checked: false },
                { id: 's18', category: 'è—¥å¦', recipient: 'é˜¿å¬¤', item: 'ROIHI-TSUBOKO ç©´ä½è²¼å¸ƒ', note: 'åœ“å½¢è²¼å¸ƒ', checked: false },
                { id: 's19', category: 'é›¶é£Ÿ', recipient: 'å…¬å¸', item: 'Jagarico è–¯æ¢æ¯ (å„åœ°é™å®š)', note: 'æ–¹ä¾¿åˆ†ç™¼', checked: false },
                { id: 's20', category: 'é›œè²¨', recipient: 'è‡ªå·±', item: '3COINS é›»å­ç”¢å“', note: 'è—ç‰™è€³æ©Ÿ/æ”¯æ¶', checked: false }
            ],
            // --- è¡Œææ¸…å–® (ä¿æŒé€šç”¨ï¼Œç¨å¾®èª¿æ•´é †åº) ---
            packingList: [
                { id: 'p0', category: 'âš ï¸ ç‰¹åˆ¥æ³¨æ„', item: 'è¡Œå‹•é›»æºè·Ÿé›»æ± è¦éš¨èº«è¡Œæ (ä¸å¯è¨—é‹)', checked: false },
                { id: 'p1', category: 'è­‰ä»¶', item: 'è­·ç…§ (æœ‰æ•ˆæœŸé™6å€‹æœˆä»¥ä¸Š)', checked: false },
                { id: 'p2', category: 'è­‰ä»¶', item: 'Visit Japan Web QR Code (æˆªåœ–)', checked: false },
                { id: 'p3', category: 'è­‰ä»¶', item: 'æ©Ÿç¥¨é›»å­æª” / è¨‚æˆ¿ç¢ºèªå–®', checked: false },
                { id: 'p4', category: 'è­‰ä»¶', item: 'SHIBUYA SKY / teamLab é ç´„æ†‘è­‰', checked: false },
                { id: 'p5', category: 'é›»å­', item: 'è¡Œå‹•é›»æº & å……é›»ç·š (USB-C/Lightning)', checked: false },
                { id: 'p6', category: 'é›»å­', item: 'ç¶²å¡ / æ¼«éŠé–‹é€šç¢ºèª', checked: false },
                { id: 'p7', category: 'è¡£ç‰©', item: 'å¥½èµ°çš„é‹ (æ±äº¬åœ°éµè½‰ä¹˜èµ°è·¯å¤š)', checked: false },
                { id: 'p8', category: 'è¡£ç‰©', item: 'æ›æ´—è¡£ç‰© (5å¤©ä»½)', checked: false },
                { id: 'p9', category: 'ç›¥æ´—', item: 'å€‹äººä¿é¤Šå“ (ç‰™åˆ·/æ´—é¢ä¹³)', checked: false },
                { id: 'p10', category: 'ç›¥æ´—', item: 'å¸¸å‚™è—¥å“ (ä¼‘è¶³æ™‚é–“/æ­¢ç—›è—¥)', checked: false },
                { id: 'p11', category: 'å…¶ä»–', item: 'æ—¥å¹£ç¾é‡‘ (Suicaå„²å€¼ç”¨)', checked: false },
                { id: 'p12', category: 'å…¶ä»–', item: 'ä¿¡ç”¨å¡ (æµ·å¤–å›é¥‹é«˜/è¥¿ç“œå¡ç¶å®š)', checked: false },
                { id: 'p13', category: 'å…¶ä»–', item: 'ç’°ä¿è³¼ç‰©è¢‹ (å¤§å®¹é‡)', checked: false },
                { id: 'p14', category: 'å…¶ä»–', item: 'è¿ªå£«å°¼é«®ç® (å¦‚æœæœ‰å»çš„è©±)', checked: false }
            ],
            // --- é è¨­æ”¯å‡ºç¯„ä¾‹ (æ±äº¬ç‰ˆ) ---
            expenses: [
                { id: 'e1', item: 'Skyliner æ©Ÿå ´å¿«ç·š', recipient: 'è‡ªå·±', category: 'äº¤é€š', priceJPY: 2570, date: '2025/07/20', isTaxFree: false },
                { id: 'e2', item: 'æ–°å®¿ Hotel ä½å®¿ (4æ™š)', recipient: 'è‡ªå·±', category: 'ä½å®¿', priceJPY: 60000, date: '2025/07/20', isTaxFree: false },
                { id: 'e3', item: 'Suica å„²å€¼', recipient: 'è‡ªå·±', category: 'äº¤é€š', priceJPY: 3000, date: '2025/07/20', isTaxFree: false },
                { id: 'e4', item: 'æ€å‡ºæ©«ä¸ ä¸²ç‡’æ™šé¤', recipient: 'è‡ªå·±', category: 'é¤é£²', priceJPY: 3500, date: '2025/07/20', isTaxFree: false },
                { id: 'e5', item: 'æ·ºè‰ äººå½¢ç‡’', recipient: 'è‡ªå·±', category: 'é¤é£²', priceJPY: 500, date: '2025/07/21', isTaxFree: false },
                { id: 'e6', item: 'æ·ºè‰ç‚¸ç‰›æ’ åˆé¤', recipient: 'è‡ªå·±', category: 'é¤é£²', priceJPY: 2800, date: '2025/07/21', isTaxFree: false },
                { id: 'e7', item: 'æ°´ä¸Šå·´å£« Hotaluna', recipient: 'è‡ªå·±', category: 'äº¤é€š', priceJPY: 1720, date: '2025/07/21', isTaxFree: false },
                { id: 'e8', item: 'æ™´ç©ºå¡” å±•æœ›å°é–€ç¥¨', recipient: 'è‡ªå·±', category: 'å¨›æ¨‚', priceJPY: 3100, date: '2025/07/21', isTaxFree: false },
                { id: 'e9', item: 'åŸå®¿ å¯éº—é¤…', recipient: 'è‡ªå·±', category: 'é¤é£²', priceJPY: 650, date: '2025/07/22', isTaxFree: false },
                { id: 'e10', item: 'SHIBUYA SKY é–€ç¥¨', recipient: 'è‡ªå·±', category: 'å¨›æ¨‚', priceJPY: 2500, date: '2025/07/22', isTaxFree: false },
                { id: 'e11', item: 'æ¾æœ¬æ¸… è—¥å¦æ¡è³¼', recipient: 'å®¶äºº', category: 'è³¼ç‰©', priceJPY: 15000, date: '2025/07/22', isTaxFree: true },
                { id: 'e12', item: 'ç¯‰åœ° æµ·é®®ä¸¼', recipient: 'è‡ªå·±', category: 'é¤é£²', priceJPY: 3800, date: '2025/07/23', isTaxFree: false },
                { id: 'e13', item: 'Uniqlo éŠ€åº§ è¡£æœ', recipient: 'è‡ªå·±', category: 'è³¼ç‰©', priceJPY: 8500, date: '2025/07/23', isTaxFree: true },
                { id: 'e14', item: 'teamLab Planets é–€ç¥¨', recipient: 'è‡ªå·±', category: 'å¨›æ¨‚', priceJPY: 3800, date: '2025/07/23', isTaxFree: false },
                { id: 'e15', item: 'æ•˜æ•˜è‹‘ ç‡’è‚‰æ™šé¤', recipient: 'è‡ªå·±', category: 'é¤é£²', priceJPY: 8000, date: '2025/07/23', isTaxFree: false },
                { id: 'e16', item: 'NY Perfect Cheese', recipient: 'æœ‹å‹', category: 'è³¼ç‰©', priceJPY: 4500, date: '2025/07/24', isTaxFree: true },
                { id: 'e17', item: 'æ±äº¬é¦™è•‰', recipient: 'åŒäº‹', category: 'è³¼ç‰©', priceJPY: 3300, date: '2025/07/24', isTaxFree: true },
                { id: 'e18', item: 'å…­å˜èˆ æ²¾éºµ', recipient: 'è‡ªå·±', category: 'é¤é£²', priceJPY: 1100, date: '2025/07/24', isTaxFree: false },
                { id: 'e19', item: 'æ‰­è›‹ (å„ç¨®)', recipient: 'è‡ªå·±', category: 'å¨›æ¨‚', priceJPY: 2000, date: '2025/07/24', isTaxFree: false },
                { id: 'e20', item: 'æ©Ÿå ´å…ç¨…åº— æœ€å¾Œè£œè²¨', recipient: 'æœ‹å‹', category: 'è³¼ç‰©', priceJPY: 5000, date: '2025/07/24', isTaxFree: true }
            ],
            phrases: {
                categories: ['è¡Œç¨‹å°ˆå±¬', 'äº¤é€šç§»å‹•', 'ç¾é£Ÿé»é¤', 'è³¼ç‰©é€€ç¨…', 'è§€å…‰åƒæ‹œ', 'ä½å®¿æ±‚åŠ©'],
                items: [
                    // --- è¡Œç¨‹å°ˆå±¬ (NEW - Based on Itinerary) ---
                    { jp: 'SHIBUYA SKYã®å…¥ã‚Šå£ã¯ã©ã“ã§ã™ã‹ï¼Ÿ', ruby: 'SHIBUYA SKY no iriguchi wa doko desu ka?', tw: 'è«‹å• SHIBUYA SKY çš„å…¥å£åœ¨å“ªè£¡ï¼Ÿ', category: 'è¡Œç¨‹å°ˆå±¬' },
                    { jp: 'TeamLabã®äºˆç´„ç”»é¢ã§ã™ã€‚', ruby: 'TeamLab no yoyaku gamen desu.', tw: 'é€™æ˜¯æˆ‘ TeamLab çš„é ç´„ç•«é¢ã€‚', category: 'è¡Œç¨‹å°ˆå±¬' },
                    { jp: 'é´ã‚’è„±ãå¿…è¦ãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿ', ruby: 'Kutsu o nugu hitsuyÅ ga arimasu ka?', tw: 'éœ€è¦è„«é‹å—ï¼Ÿ (TeamLabç”¨)', category: 'è¡Œç¨‹å°ˆå±¬' },
                    { jp: 'å…­å˜èˆã®åˆ—ã¯ã“ã“ã§ã™ã‹ï¼Ÿ', ruby: 'Rokurinsha no retsu wa koko desu ka?', tw: 'è«‹å•å…­å˜èˆæ˜¯åœ¨é€™è£¡æ’éšŠå—ï¼Ÿ', category: 'è¡Œç¨‹å°ˆå±¬' },
                    { jp: 'æ±äº¬ã°ãªå¥ˆã®ãƒ©ãƒƒã‚³å‘³ã‚’æ¢ã—ã¦ã„ã¾ã™ã€‚', ruby: 'Tokyo Banana no Rakko-aji o sagashite imasu.', tw: 'æˆ‘åœ¨æ‰¾æµ·çºå£å‘³çš„æ±äº¬é¦™è•‰ã€‚', category: 'è¡Œç¨‹å°ˆå±¬' },
                    { jp: 'ãƒ‹ãƒ¥ãƒ¼ãƒ¨ãƒ¼ã‚¯ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆãƒãƒ¼ã‚ºã¯å£²ã‚Šåˆ‡ã‚Œã§ã™ã‹ï¼Ÿ', ruby: 'NY Perfect Cheese wa urikire desu ka?', tw: 'è«‹å• NY Perfect Cheese è³£å®Œäº†å—ï¼Ÿ', category: 'è¡Œç¨‹å°ˆå±¬' },
                    { jp: 'ã‚¹ã‚«ã‚¤ãƒ„ãƒªãƒ¼ã®ãƒã‚±ãƒƒãƒˆå£²ã‚Šå ´ã¯ã©ã“ã§ã™ã‹ï¼Ÿ', ruby: 'SukaitsurÄ« no chiketto uriba wa doko desu ka?', tw: 'è«‹å•æ™´ç©ºå¡”çš„å”®ç¥¨è™•åœ¨å“ªè£¡ï¼Ÿ', category: 'è¡Œç¨‹å°ˆå±¬' },
                    { jp: 'æ­Œèˆä¼ç”ºä¸€ç•ªè¡—ã¯ã©ã¡ã‚‰ã§ã™ã‹ï¼Ÿ', ruby: 'KabukichÅ Ichibangai wa dochira desu ka?', tw: 'è«‹å•æ­Œèˆä¼ç”ºä¸€ç•ªè¡—å¾€å“ªé‚Šèµ°ï¼Ÿ', category: 'è¡Œç¨‹å°ˆå±¬' },

                    // äº¤é€šç§»å‹•
                    { jp: 'æ±äº¬é§…ï¼æ–°å®¿é§…ã«è¡ŒããŸã„ã§ã™ã€‚', ruby: 'TÅkyÅ-eki / Shinjuku-eki ni ikitai desu.', tw: 'æˆ‘æƒ³å»æ±äº¬ç«™/æ–°å®¿ç«™ã€‚', category: 'äº¤é€šç§»å‹•' },
                    { jp: 'ã‚¹ã‚«ã‚¤ãƒ„ãƒªãƒ¼è¡Œãã®ãƒã‚¹ã¯ã©ã‚Œã§ã™ã‹ï¼Ÿ', ruby: 'SukaitsurÄ«-iki no basu wa dore desu ka?', tw: 'å»æ™´ç©ºå¡”çš„å…¬è»Šæ˜¯å“ªä¸€ç­ï¼Ÿ', category: 'äº¤é€šç§»å‹•' },
                    { jp: 'åœ°ä¸‹é‰„ã®è·¯ç·šå›³ã‚’ãã ã•ã„ã€‚', ruby: 'Chikatetsu no rosenzu o kudasai.', tw: 'è«‹çµ¦æˆ‘åœ°éµè·¯ç·šåœ–ã€‚', category: 'äº¤é€šç§»å‹•' },
                    { jp: 'æµ…è‰ã«ã¯ã©ã†è¡Œã‘ã°ã„ã„ã§ã™ã‹ï¼Ÿ', ruby: 'Asakusa ni wa dÅ ikeba ii desu ka?', tw: 'è«‹å•æ·ºè‰è¦æ€éº¼å»ï¼Ÿ', category: 'äº¤é€šç§»å‹•' },
                    { jp: 'ã“ã®é›»è»Šã¯æˆç”°ï¼ç¾½ç”°ç©ºæ¸¯ã«è¡Œãã¾ã™ã‹ï¼Ÿ', ruby: 'Kono densha wa Narita / Haneda kÅ«kÅ ni ikimasu ka?', tw: 'é€™ç­è»Šæœƒå»æˆç”°/ç¾½ç”°æ©Ÿå ´å—ï¼Ÿ', category: 'äº¤é€šç§»å‹•' },
                    { jp: 'å±±æ‰‹ç·šã¯ã©ã“ã§ã™ã‹ï¼Ÿ', ruby: 'Yamanote-sen wa doko desu ka?', tw: 'è«‹å•å±±æ‰‹ç·šåœ¨å“ªè£¡ï¼Ÿ', category: 'äº¤é€šç§»å‹•' },
                    { jp: 'å‡ºå£ã¯ã©ã“ã§ã™ã‹ï¼Ÿï¼ˆæ±å£ï¼è¥¿å£ï¼‰', ruby: 'Deguchi wa doko desu ka? (Higashi-guchi / Nishi-guchi)', tw: 'è«‹å•å‡ºå£åœ¨å“ªè£¡ï¼Ÿ(æ±å£/è¥¿å£)', category: 'äº¤é€šç§»å‹•' },
                    { jp: 'Suicaã«ãƒãƒ£ãƒ¼ã‚¸ã—ãŸã„ã§ã™ã€‚', ruby: 'Suica ni chÄji shitai desu.', tw: 'æˆ‘æƒ³å¹« Suica å„²å€¼ã€‚', category: 'äº¤é€šç§»å‹•' },
                    
                    // ç¾é£Ÿ
                    { jp: 'ãŠã¾ã‹ã›ã§ãŠé¡˜ã„ã—ã¾ã™ã€‚', ruby: 'Omakase de onegaishimasu.', tw: 'è«‹äº¤çµ¦ä¸»å»šæ¨è–¦ (å£½å¸åº—å¸¸ç”¨)ã€‚', category: 'ç¾é£Ÿé»é¤' },
                    { jp: 'è‹±èªã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ', ruby: 'Eigo no menyÅ« wa arimasu ka?', tw: 'æœ‰è‹±æ–‡èœå–®å—ï¼Ÿ', category: 'ç¾é£Ÿé»é¤' },
                    { jp: 'ãƒ†ã‚¤ã‚¯ã‚¢ã‚¦ãƒˆã§ãã¾ã™ã‹ï¼Ÿ', ruby: 'Teikuauto dekimasu ka?', tw: 'å¯ä»¥å¤–å¸¶å—ï¼Ÿ', category: 'ç¾é£Ÿé»é¤' },
                    { jp: 'ä¸€äººã§ã™ã€‚', ruby: 'Hitori desu.', tw: 'æˆ‘ä¸€å€‹äººã€‚', category: 'ç¾é£Ÿé»é¤' },
                    { jp: 'å†™çœŸã‚’æ’®ã£ã¦ã‚‚ã„ã„ã§ã™ã‹ï¼Ÿ', ruby: 'Shashin o totte mo ii desu ka?', tw: 'è«‹å•å¯ä»¥æ‹ç…§å—ï¼Ÿ', category: 'ç¾é£Ÿé»é¤' },
                    { jp: 'ãŠä¼šè¨ˆã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚', ruby: 'Okaikei o onegaishimasu.', tw: 'éº»ç…©çµå¸³ã€‚', category: 'ç¾é£Ÿé»é¤' },
                    
                    // è³¼ç‰©
                    { jp: 'å…ç¨ã«ãªã‚Šã¾ã™ã‹ï¼Ÿ', ruby: 'Menzei ni narimasu ka?', tw: 'é€™å€‹å¯ä»¥é€€ç¨…å—ï¼Ÿ', category: 'è³¼ç‰©é€€ç¨…' },
                    { jp: 'æ–°ã—ã„ã®ã‚’å‡ºã—ã¦ã‚‚ã‚‰ãˆã¾ã™ã‹ï¼Ÿ', ruby: 'Atarashii no o dashite moraemasu ka?', tw: 'å¯ä»¥æ‹¿æ–°çš„çµ¦æˆ‘å—ï¼Ÿ', category: 'è³¼ç‰©é€€ç¨…' },
                    { jp: 'ã“ã‚Œã‚’æ¢ã—ã¦ã„ã¾ã™ã€‚', ruby: 'Kore o sagashite imasu.', tw: 'æˆ‘åœ¨æ‰¾é€™å€‹ (çµ¦çœ‹åœ–ç‰‡)ã€‚', category: 'è³¼ç‰©é€€ç¨…' },
                    { jp: 'è©¦ç€å®¤ã¯ã©ã“ã§ã™ã‹ï¼Ÿ', ruby: 'Shichakushitsu wa doko desu ka?', tw: 'è©¦è¡£é–“åœ¨å“ªè£¡ï¼Ÿ', category: 'è³¼ç‰©é€€ç¨…' },
                    
                    // è§€å…‰
                    { jp: 'ã‚·ãƒ£ãƒƒã‚¿ãƒ¼ã‚’æŠ¼ã—ã¦ã‚‚ã‚‰ãˆã¾ã™ã‹ï¼Ÿ', ruby: 'ShattÄ o oshite moraemasu ka?', tw: 'å¯ä»¥å¹«æˆ‘å€‘æŒ‰å¿«é–€å—ï¼Ÿ', category: 'è§€å…‰åƒæ‹œ' },
                    { jp: 'å¾¡æœ±å°ã¯ã©ã“ã§é ‚ã‘ã¾ã™ã‹ï¼Ÿ', ruby: 'Goshuin wa doko de itadakemasu ka?', tw: 'è«‹å•å“ªè£¡å¯ä»¥å¯«å¾¡æœ±å°ï¼Ÿ', category: 'è§€å…‰åƒæ‹œ' },
                    { jp: 'ã“ã“ã‹ã‚‰å¯Œå£«å±±ã¯è¦‹ãˆã¾ã™ã‹ï¼Ÿ', ruby: 'Koko kara Fujisan wa miemasu ka?', tw: 'å¾é€™è£¡çœ‹å¾—åˆ°å¯Œå£«å±±å—ï¼Ÿ', category: 'è§€å…‰åƒæ‹œ' },
                    
                    // ä½å®¿
                    { jp: 'è·ç‰©ã‚’é ã‹ã£ã¦ã‚‚ã‚‰ãˆã¾ã™ã‹ï¼Ÿ', ruby: 'Nimotsu o azukatte moraemasu ka?', tw: 'å¯ä»¥å¯„æ”¾è¡Œæå—ï¼Ÿ', category: 'ä½å®¿æ±‚åŠ©' },
                    { jp: 'è¿‘ãã«ã‚³ãƒ³ãƒ“ãƒ‹ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ', ruby: 'Chikaku ni konbini wa arimasu ka?', tw: 'é™„è¿‘æœ‰ä¾¿åˆ©å•†åº—å—ï¼Ÿ', category: 'ä½å®¿æ±‚åŠ©' }
                ]
            }
        };

        // --- 1. Utilities ---
        function showToast(msg) {
            const container = document.getElementById('toast-container');
            const el = document.createElement('div');
            el.className = 'toast';
            el.innerHTML = `<span>${msg}</span>`;
            container.appendChild(el);
            setTimeout(()=>el.classList.add('show'), 10);
            setTimeout(()=>{ el.classList.remove('show'); setTimeout(()=>el.remove(), 300); }, 2000);
        }

        function getMapUrl(q) { return `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(q + " æ±äº¬")}`; }
        function getDailyRouteUrl(tl) { 
            if (!tl || tl.length === 0) return "#";
            const locs = tl.map(i => i.title + " æ±äº¬"); 
            return `https://www.google.com/maps/dir/?api=1&origin=${encodeURIComponent(locs[0])}&destination=${encodeURIComponent(locs[locs.length-1])}&waypoints=${encodeURIComponent(locs.slice(1,-1).join('|'))}&travelmode=transit`; 
        }
        function getSearchUrl(title) { return `https://www.google.com/search?q=${encodeURIComponent(title + " æ±äº¬ éŠè¨˜ æ¨è–¦ è¯äºº 2024 2025")}`; }

        // Core Data Function
        function getAllSpots() {
             let spots = [];
             if (appData && appData.itineraries) {
                 Object.values(appData.itineraries).forEach(day => {
                     if (day.timeline) {
                         day.timeline.forEach(t => spots.push(t.title));
                     }
                 });
             }
             if (appData && appData.shoppingList) {
                 appData.shoppingList.forEach(item => {
                     if (item.location && item.location.trim() !== "") {
                         spots.push(item.location.trim());
                     }
                 });
             }
             return [...new Set(spots)].sort();
        }

        async function fetchExchangeRate() {
            try {
                const res = await fetch('https://api.exchangerate-api.com/v4/latest/JPY');
                const data = await res.json();
                if (data?.rates?.TWD) {
                    appData.config.currencyRate = data.rates.TWD;
                    saveAll(false); 
                    if(currentState.activeTab === 'toolbox' && currentState.activeToolId === 'budget') renderBudget();
                }
            } catch (e) { console.log("Rate API Error, using default"); }
        }

        // --- Functions ---

        function saveAll(showNotify = true) { 
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify({ 
                    list: appData.shoppingList, 
                    packing: appData.packingList, 
                    expenses: appData.expenses, 
                    config: appData.config,
                    itineraries: appData.itineraries
                })); 
                if(showNotify) showToast("ğŸ’¾ å·²è‡ªå‹•å­˜æª”");
            } catch (e) { console.error(e); showToast("âŒ å­˜æª”å¤±æ•—"); }
        }
        
        function loadAll() {
            try {
                const data = JSON.parse(localStorage.getItem(STORAGE_KEY));
                if (data) {
                    appData.shoppingList = data.list || appData.shoppingList;
                    appData.packingList = data.packing || appData.packingList;
                    appData.expenses = data.expenses || appData.expenses;
                    appData.config = { ...appData.config, ...(data.config || {}) };
                    if (data.itineraries) appData.itineraries = data.itineraries;
                    showToast("ğŸ“‚ å·²è®€å–æ­·å²ç´€éŒ„");
                }
            } catch(e) { console.error(e); }
        }

        function switchTab(id) { 
            currentState.activeTab = id; 
            if (id !== 'toolbox') {
                 currentState.activeToolId = null; 
            } else {
                currentState.activeToolId = null; 
            }
            renderNav(); 
            renderContent(); 
            window.scrollTo({top:0, behavior:'smooth'}); 
        }

        function openTool(toolId) {
            currentState.activeToolId = toolId;
            if (toolId === 'phrases') {
                currentState.activePhraseCategory = null;
            }
            renderContent();
            window.scrollTo({top:0, behavior:'smooth'});
        }

        function closeTool() {
            currentState.activeToolId = null;
            renderContent();
            window.scrollTo({top:0, behavior:'smooth'});
        }
        
        function toggleDataMode() { currentState.showTextBackup = !currentState.showTextBackup; renderShopping(); }
        function restoreFromDataCode() {
            const code = document.getElementById('backupCodeArea').value.trim();
            if (!code) return alert("è«‹è¼¸å…¥å‚™ä»½ç¢¼");
            try {
                const data = JSON.parse(code);
                if (confirm("ç¢ºå®šè¦é‚„åŸå—ï¼Ÿé€™å°‡è¦†è“‹ç¾æœ‰è³‡æ–™ã€‚")) {
                    appData.shoppingList = data.list || appData.shoppingList;
                    appData.packingList = data.packing || appData.packingList;
                    appData.expenses = data.expenses || appData.expenses;
                    appData.config = { ...appData.config, ...(data.config || {}) };
                    saveAll(); currentState.showTextBackup = false; renderShopping(); alert("é‚„åŸæˆåŠŸï¼");
                }
            } catch (e) { alert("ç„¡æ•ˆçš„å‚™ä»½ç¢¼æ ¼å¼"); }
        }

        function openNotebook() {
            let content = "# æ‰‹å¸³æç¤ºè©ï¼šæ±äº¬æ¥µè‡´æ—…èªŒ\n\n";
            content += "## ğŸ¨ å°é¢è¨­è¨ˆæç¤ºè© (Cover Image Prompt)\n";
            content += "æ‚¨å¯ä»¥å°‡ä»¥ä¸‹æç¤ºè©è¤‡è£½åˆ° Midjourney, DALL-E æˆ–å…¶ä»– AI ç¹ªåœ–å·¥å…·ï¼Œç”Ÿæˆç¬¦åˆæœ¬æ‰‹å¸³é¢¨æ ¼çš„å°é¢åœ–ï¼š\n\n";
            content += "`Minimalist travel journal cover for Tokyo, titled 'TOKYO TYPOGRAPHIC JOURNAL'. Design style: Modern Japanese aesthetic, Swiss International Style layout. Visual elements: A bold, stylized red circle (representing the sun) interacting with a black and white photo of Shibuya Crossing or Tokyo Tower. Typography: Large, bold Sans-serif English font mixed with elegant, vertical Kanji calligraphy. Colors: White background, deep indigo blue (#223A70), stark black (#1A1A1A), and metallic gold accents. Texture: High-quality matte paper texture.`\n\n";
            content += "---\n\n";
            content += "## ğŸ“ å…§å®¹ç”Ÿæˆæç¤ºè© (Content Prompts)\n";
            content += "æœ¬æ‰‹å†Šå½™æ•´äº†æ±äº¬äº”æ—¥éŠçš„è©³ç´°è¡Œç¨‹ã€æ™¯é»ä»‹ç´¹èˆ‡æ”å½±æŒ‡å—ï¼Œå°ˆç‚ºç”ŸæˆèªéŸ³å°è¦½æˆ–æ—…éŠæ›¸è¨­è¨ˆã€‚\n\n";
            for (let i = 1; i <= 5; i++) {
                const dayId = 'day' + i;
                const day = appData.itineraries[dayId];
                if (day) {
                    content += `### ç¬¬${i}å¤©ï¼š${day.title} (${day.subtitle})\n`;
                    content += `> å‰è¨€ï¼š${day.intro}\n\n`;
                    day.timeline.forEach(item => {
                        content += `**${item.time} ${item.title}** [${item.tag}]\n`;
                        content += `* **æ™¯é»æè¿°**ï¼š${item.desc}\n`;
                        content += `* **æ”å½±æŒ‡å—**ï¼š${item.photoTip}\n`;
                        if(item.tips) content += `* **å¯¦ç”¨è²¼å£«**ï¼š${item.tips}\n`;
                        content += `\n`;
                    });
                    content += `---\n\n`;
                }
            }
            document.getElementById('notebook-content').value = content;
            document.getElementById('notebook-modal').classList.add('active');
        }
        function closeNotebook() { document.getElementById('notebook-modal').classList.remove('active'); }
        function copyNotebookContent() {
            const el = document.getElementById('notebook-content');
            el.select(); document.execCommand('copy');
            showToast("âœ¨ å·²è¤‡è£½ï¼è«‹è²¼ä¸Šè‡³ NotebookLM");
        }

        function renderNav() {
            document.getElementById('nav-container').innerHTML = appData.tabs.map(t => `
                <button onclick="switchTab('${t.id}')" class="flex-shrink-0 lg:w-full text-left px-3 md:px-4 py-2 lg:py-3 font-mono text-xs border-b-2 lg:border-b-0 lg:border-l-4 transition-all ${currentState.activeTab === t.id ? 'bg-tokyo-ink text-tokyo-bg border-tokyo-gold shadow-md scale-100' : 'bg-white lg:bg-transparent text-tokyo-ink border-transparent hover:bg-white'}">
                    <span class="font-bold tracking-tight uppercase whitespace-nowrap">${t.label}</span>
                </button>`).join('');
            lucide.createIcons();
        }

        function renderContent() {
            const t = appData.tabs.find(x => x.id === currentState.activeTab);
            const headerEl = document.getElementById('section-header');
            if (t.type === 'itinerary') {
                headerEl.style.display = 'block';
                headerEl.innerHTML = `<h2 class="text-2xl md:text-4xl font-serif font-bold tracking-tight text-tokyo-ink mb-1">${appData.itineraries[t.id].title}</h2><p class="text-xs text-gray-500 font-mono uppercase tracking-widest">Section: ${t.type}</p>`;
                renderItinerary(t.id);
            } else if (t.id === 'toolbox') {
                headerEl.style.display = 'none';
                renderToolbox();
            }
            lucide.createIcons();
        }

        function renderToolbox() {
            const container = document.getElementById('content-area');
            if (!currentState.activeToolId) {
                const totalSpent = Math.round(appData.expenses.reduce((a,b)=>a+b.priceJPY,0) * appData.config.currencyRate);
                const budgetLeft = appData.config.budgetTWD - totalSpent;
                const shopTotal = appData.shoppingList.length;
                const shopDone = appData.shoppingList.filter(x=>x.checked).length;
                const packTotal = appData.packingList.length;
                const packDone = appData.packingList.filter(x=>x.checked).length;

                container.innerHTML = `
                    <div class="mb-8 border-b-2 border-tokyo-ink pb-4">
                        <h2 class="text-3xl md:text-4xl font-serif font-bold tracking-tight text-tokyo-ink mb-1">æ—…äººå·¥å…·ç®±</h2>
                        <p class="text-xs text-gray-500 font-mono uppercase tracking-widest">Traveler's Toolbox</p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div onclick="openTool('budget')" class="bright-card p-6 cursor-pointer tool-card group">
                            <div class="flex justify-between items-start mb-4">
                                <div class="p-3 bg-tokyo-ink text-white rounded-sm"><i data-lucide="calculator" class="w-6 h-6"></i></div>
                                <div class="text-right">
                                    <p class="text-[10px] uppercase font-bold text-gray-400 tracking-wider">Remaining</p>
                                    <p class="text-xl font-mono font-bold ${budgetLeft<0?'text-red-600':'text-green-600'}">NT$${budgetLeft.toLocaleString()}</p>
                                </div>
                            </div>
                            <h3 class="text-xl font-bold mb-1 group-hover:text-tokyo-blue transition-colors">é ç®—èˆ‡è¨˜å¸³</h3>
                            <p class="text-xs text-gray-500 font-medium">è¿½è¹¤æ—¥å¹£æ”¯å‡ºèˆ‡å‰©é¤˜é ç®—</p>
                        </div>
                        <div onclick="openTool('shopping')" class="bright-card p-6 cursor-pointer tool-card group">
                            <div class="flex justify-between items-start mb-4">
                                <div class="p-3 bg-tokyo-ink text-white rounded-sm"><i data-lucide="shopping-bag" class="w-6 h-6"></i></div>
                                <div class="text-right">
                                    <p class="text-[10px] uppercase font-bold text-gray-400 tracking-wider">Progress</p>
                                    <p class="text-xl font-mono font-bold text-tokyo-ink">${shopDone}/${shopTotal}</p>
                                </div>
                            </div>
                            <h3 class="text-xl font-bold mb-1 group-hover:text-tokyo-blue transition-colors">è³¼ç‰©æ¸…å–®</h3>
                            <p class="text-xs text-gray-500 font-medium">ç®¡ç†å¿…è²·ç‰©å“èˆ‡æˆ°åˆ©å“</p>
                        </div>
                        <div onclick="openTool('packing')" class="bright-card p-6 cursor-pointer tool-card group">
                            <div class="flex justify-between items-start mb-4">
                                <div class="p-3 bg-tokyo-ink text-white rounded-sm"><i data-lucide="briefcase" class="w-6 h-6"></i></div>
                                <div class="text-right">
                                    <p class="text-[10px] uppercase font-bold text-gray-400 tracking-wider">Packed</p>
                                    <p class="text-xl font-mono font-bold text-tokyo-ink">${packDone}/${packTotal}</p>
                                </div>
                            </div>
                            <h3 class="text-xl font-bold mb-1 group-hover:text-tokyo-blue transition-colors">è¡Œææ¸…å–®</h3>
                            <p class="text-xs text-gray-500 font-medium">å‡ºç™¼å‰èˆ‡å›ç¨‹æª¢æŸ¥è¡¨</p>
                        </div>
                        <div onclick="openTool('phrases')" class="bright-card p-6 cursor-pointer tool-card group">
                            <div class="flex justify-between items-start mb-4">
                                <div class="p-3 bg-tokyo-ink text-white rounded-sm"><i data-lucide="message-circle" class="w-6 h-6"></i></div>
                                <div class="text-right">
                                    <p class="text-[10px] uppercase font-bold text-gray-400 tracking-wider">Language</p>
                                    <p class="text-xl font-mono font-bold text-tokyo-ink">JP/TW</p>
                                </div>
                            </div>
                            <h3 class="text-xl font-bold mb-1 group-hover:text-tokyo-blue transition-colors">æŒ‡å·®æœƒè©±</h3>
                            <p class="text-xs text-gray-500 font-medium">ä¸­æ—¥èªéŸ³ç¿»è­¯èˆ‡æºé€šå¡ç‰‡</p>
                        </div>
                    </div>
                `;
            } else {
                const tool = appData.tools.find(t => t.id === currentState.activeToolId);
                const headerHtml = `
                    <div class="mb-6 flex items-center gap-4 border-b-2 border-tokyo-ink pb-4">
                        <button onclick="closeTool()" class="bg-white border border-tokyo-ink p-2 hover:bg-tokyo-bg transition-colors shadow-sm rounded-sm">
                            <i data-lucide="arrow-left" class="w-5 h-5 text-tokyo-ink"></i>
                        </button>
                        <div>
                            <h2 class="text-2xl font-serif font-bold tracking-tight text-tokyo-ink flex items-center gap-2">
                                ${tool.label}
                            </h2>
                            <p class="text-xs text-gray-500 font-mono uppercase tracking-widest">${tool.desc}</p>
                        </div>
                    </div>
                `;
                
                if (currentState.activeToolId === 'budget') renderBudget();
                else if (currentState.activeToolId === 'shopping') renderShopping();
                else if (currentState.activeToolId === 'packing') renderPacking();
                else if (currentState.activeToolId === 'phrases') renderPhrases();
            }
        }
        
        function getBackHeaderHTML(title, subtitle) {
            return `
                <div class="mb-6 flex items-center gap-4 border-b-2 border-tokyo-ink pb-4">
                    <button onclick="closeTool()" class="bg-white border border-tokyo-ink p-2 hover:bg-tokyo-bg transition-colors shadow-sm rounded-sm group">
                        <i data-lucide="arrow-left" class="w-5 h-5 text-tokyo-ink group-hover:text-tokyo-blue"></i>
                    </button>
                    <div>
                        <h2 class="text-2xl font-serif font-bold tracking-tight text-tokyo-ink">${title}</h2>
                        <p class="text-xs text-gray-500 font-mono uppercase tracking-widest">${subtitle}</p>
                    </div>
                </div>
            `;
        }

        // --- é ç®—æ¸²æŸ“ (Updated) ---
        function addBudgetExpense() {
            const item = document.getElementById('expItem').value.trim();
            const recipient = document.getElementById('expRecipient').value.trim() || 'è‡ªå·±';
            let price = parseInt(document.getElementById('expPrice').value) || 0;
            const cat = document.getElementById('expCat').value;
            const isTaxFree = document.getElementById('expTaxFree').checked;
            if (!item || price <= 0) return;
            if (isTaxFree) price = Math.round(price / 1.1);
            appData.expenses.unshift({ id: 'e_'+Date.now(), item, recipient, category: cat, priceJPY: price, date: new Date().toLocaleDateString(), isTaxFree });
            saveAll(); renderBudget();
        }
        function deleteExpense(id) { if(confirm('åˆªé™¤ï¼Ÿ')){ appData.expenses=appData.expenses.filter(x=>x.id!==id); saveAll(); renderBudget(); } }
        function renderBudget() {
            const rate = appData.config.currencyRate, totalJPY = appData.expenses.reduce((a,b)=>a+b.priceJPY, 0), totalTWD = Math.round(totalJPY * rate);
            const budget = appData.config.budgetTWD, rem = budget - totalTWD, pct = Math.min(100, Math.round((totalTWD/budget)*100));
            const isOver = rem < 0;

            let html = '';
            if (currentState.activeTab === 'toolbox') html += getBackHeaderHTML('é ç®—èˆ‡è¨˜å¸³', 'Expense Tracker');

            html += `
                <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 lg:gap-10">
                    <div class="lg:col-span-12">
                        <div class="bright-card p-4 md:p-6 grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="space-y-1">
                                <label class="text-[9px] font-bold uppercase tracking-wider opacity-40">Progress</label>
                                <div class="highlight-number text-tokyo-ink">${pct}%</div>
                                <div class="w-full bg-tokyo-gray h-2 mt-2 border border-tokyo-ink"><div class="h-full ${pct > 90?'bg-red-600':'bg-tokyo-blue'}" style="width:${pct}%"></div></div>
                            </div>
                            <div class="space-y-1">
                                <label class="text-[9px] font-bold uppercase tracking-wider opacity-40">Total Spent</label>
                                <div class="highlight-number text-tokyo-ink">NT$${totalTWD.toLocaleString()}</div>
                                <p class="text-[10px] font-mono opacity-40 mt-1">Â¥${totalJPY.toLocaleString()} JPY</p>
                            </div>
                            <div class="space-y-1 ${isOver ? 'bg-red-50 p-3 -m-3 rounded' : ''}">
                                <label class="text-[9px] font-bold uppercase tracking-wider opacity-40">Remaining</label>
                                <div class="highlight-number ${isOver?'text-red-600':'text-green-600'}">NT$${rem.toLocaleString()}</div>
                                <p class="text-xs font-mono font-bold opacity-30 mt-1">Rate: ${rate}</p>
                            </div>
                        </div>
                    </div>
                    <div class="lg:col-span-8 order-2 space-y-4">
                        <div class="bg-white border border-tokyo-ink p-4 shadow-sm">
                            <h4 class="font-bold border-b border-tokyo-ink pb-2 mb-3 text-xs uppercase tracking-wider text-tokyo-blue">New Expense</h4>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-3">
                                <input id="expItem" class="border border-tokyo-ink p-2 text-sm w-full outline-none focus:border-tokyo-blue" placeholder="é …ç›®">
                                <input id="expRecipient" list="recipientOpts" class="border border-tokyo-ink p-2 text-sm w-full outline-none focus:border-tokyo-blue" placeholder="å°è±¡" value="è‡ªå·±">
                            </div>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-3">
                                <input id="expPrice" type="number" class="border border-tokyo-ink p-2 text-base font-mono w-full outline-none focus:border-tokyo-blue" placeholder="Â¥ JPY">
                                <select id="expCat" class="border border-tokyo-ink p-2 text-sm w-full outline-none focus:border-tokyo-blue"><option>é¤é£²</option><option>äº¤é€š</option><option>è³¼ç‰©</option><option>ä½å®¿</option><option>å¨›æ¨‚</option><option>å…¶ä»–</option></select>
                            </div>
                            <div class="flex items-center gap-2 mb-3"><input type="checkbox" id="expTaxFree"><label for="expTaxFree" class="text-xs font-bold cursor-pointer">å…ç¨… (Tax Free)</label></div>
                            <button onclick="addBudgetExpense()" class="w-full bg-tokyo-ink text-white py-2 font-bold uppercase hover:bg-tokyo-blue transition-all text-xs tracking-wider shadow">Record</button>
                        </div>
                        <div class="bg-white border border-tokyo-ink">
                            ${appData.expenses.map(e => `
                                <div class="flex items-center p-3 border-b border-tokyo-ink last:border-b-0 hover:bg-tokyo-bg transition-colors">
                                    <div class="flex-grow">
                                        <div class="flex items-center gap-2 mb-1"><span class="text-[9px] bg-tokyo-ink text-white px-1 py-0.5 rounded-sm uppercase">${e.recipient}</span>${e.isTaxFree?'<span class="text-[9px] text-green-600 border border-green-600 px-1">TAX FREE</span>':''}</div>
                                        <div class="font-bold text-base text-tokyo-ink">${e.item}</div><div class="text-[9px] text-gray-400 font-mono mt-0.5">${e.date} | ${e.category}</div>
                                    </div>
                                    <div class="text-right mr-3">
                                        <div class="font-mono font-bold text-lg">Â¥${e.priceJPY.toLocaleString()}</div>
                                        <div class="text-[9px] text-gray-400 font-bold">NT$${Math.round(e.priceJPY*rate).toLocaleString()}</div>
                                    </div>
                                    <button onclick="deleteExpense('${e.id}')" class="text-gray-300 hover:text-red-500 p-1"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                                </div>`).join('')}
                        </div>
                    </div>
                    <div class="lg:col-span-4 order-3 space-y-4">
                        <div class="bg-white border border-tokyo-ink p-4 shadow-sm">
                            <h3 class="text-base font-bold border-b border-tokyo-ink pb-2 mb-4 uppercase">Settings</h3>
                            <div class="space-y-4">
                                <div><label class="text-[9px] font-bold opacity-50 uppercase block mb-1">Budget (TWD)</label>
                                <input type="number" value="${budget}" onchange="appData.config.budgetTWD=parseInt(this.value);saveAll();renderBudget();" class="w-full border-b-2 border-tokyo-ink font-mono py-1 outline-none text-xl font-bold bg-transparent"></div>
                                <button onclick="saveAll(true)" class="w-full py-2 bg-tokyo-blue text-white font-bold text-[10px] hover:bg-blue-900 transition-all flex items-center justify-center gap-1 shadow uppercase"><i data-lucide="save" class="w-3 h-3"></i> Force Save</button>
                                <button onclick="exportBudgetCSV()" class="w-full py-2 bg-tokyo-ink text-white font-bold text-[10px] hover:bg-tokyo-blue transition-all flex items-center justify-center gap-1 shadow uppercase"><i data-lucide="file-text" class="w-3 h-3"></i> Export CSV</button>
                            </div>
                        </div>
                    </div>
                </div>`;
            document.getElementById('content-area').innerHTML = html;
            lucide.createIcons();
        }

        // --- è³¼ç‰©æ¸²æŸ“ (Updated) ---
        function addShopItem() {
            const name = document.getElementById('shopName').value.trim();
            const cat = document.getElementById('shopCat').value.trim() || 'å…¶ä»–';
            const recipient = document.getElementById('shopRecipient').value.trim() || 'è‡ªå·±';
            const location = document.getElementById('shopLoc').value.trim();
            const note = document.getElementById('shopNote').value.trim();
            if (!name) return;
            appData.shoppingList.unshift({ id: 's_'+Date.now(), category: cat, recipient, item: name, location, note, checked: false });
            saveAll(); renderShopping();
        }
        function toggleShopCheck(id) { const x = appData.shoppingList.find(a=>a.id===id); if(x) { x.checked = !x.checked; saveAll(); renderContent(); } }
        function deleteShopItem(id) { if(confirm('åˆªé™¤ï¼Ÿ')){ appData.shoppingList = appData.shoppingList.filter(x=>x.id!==id); saveAll(); renderShopping(); } }
        function renderShopping() {
            const total = appData.shoppingList.length, done = appData.shoppingList.filter(x=>x.checked).length, pct = total > 0 ? Math.round((done/total)*100) : 0;
            const backupText = JSON.stringify({ list: appData.shoppingList, packing: appData.packingList, expenses: appData.expenses, config: appData.config });
            
            let html = '';
            if (currentState.activeTab === 'toolbox') html += getBackHeaderHTML('è³¼ç‰©æ¸…å–®', 'Shopping List');
             
             const spots = getAllSpots();
             const optionsHtml = spots.map(s => `<option value="${s}">`).join('');
             let dl = document.getElementById('spotOpts');
             if(!dl) {
                 dl = document.createElement('datalist'); dl.id='spotOpts'; 
                 document.body.appendChild(dl);
             }
             dl.innerHTML = optionsHtml;

            html += `
                <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 lg:gap-10">
                    <div class="lg:col-span-8 order-2 space-y-4">
                        <div class="bg-white border border-tokyo-ink p-4 shadow-sm">
                            <h4 class="font-bold border-b border-tokyo-ink pb-2 mb-4 text-xs uppercase tracking-wider text-tokyo-blue">New Item</h4>
                            <div class="grid grid-cols-1 sm:grid-cols-4 gap-3 mb-3">
                                <input id="shopCat" list="catOpts" class="border border-tokyo-ink p-2 text-sm w-full outline-none" placeholder="é¡åˆ¥">
                                <input id="shopRecipient" list="recipientOpts" class="border border-tokyo-ink p-2 text-sm w-full outline-none" placeholder="å°è±¡" value="è‡ªå·±">
                                <input id="shopLoc" list="spotOpts" class="border border-tokyo-ink p-2 text-sm w-full outline-none" placeholder="é—œè¯æ™¯é»">
                                <input id="shopName" class="border border-tokyo-ink p-2 text-sm font-bold w-full outline-none" placeholder="å•†å“åç¨±">
                            </div>
                            <div class="flex gap-3"><input id="shopNote" class="border border-tokyo-ink p-2 flex-grow text-sm outline-none" placeholder="å‚™è¨»"><button onclick="addShopItem()" class="bg-tokyo-ink text-white px-6 py-2 font-bold hover:bg-tokyo-blue transition-all uppercase text-xs shadow">Add</button></div>
                        </div>
                        <div class="bg-white border border-tokyo-ink overflow-hidden">
                            ${appData.shoppingList.map(i => `
                                <div class="flex items-center p-4 border-b border-tokyo-ink last:border-b-0 hover:bg-tokyo-bg cursor-pointer group" onclick="toggleShopCheck('${i.id}')">
                                    <div class="w-6 h-6 border mr-4 flex items-center justify-center transition-all ${i.checked?'bg-tokyo-ink border-tokyo-ink text-white':'bg-white border-tokyo-ink'}">${i.checked?'<i data-lucide="check" class="w-4 h-4"></i>':''}</div>
                                    <div class="flex-grow ${i.checked?'opacity-30':''}">
                                        <div class="flex items-baseline gap-2 mb-1">
                                            <span class="text-[9px] bg-tokyo-blue text-white px-1.5 py-0.5 font-bold uppercase rounded-sm">${i.recipient}</span>
                                            <span class="text-[9px] bg-gray-200 px-1.5 py-0.5 font-bold text-gray-700 rounded-sm">${i.category}</span>
                                            ${i.location ? `<span class="text-[9px] border border-purple-500 text-purple-600 px-1.5 py-0.5 font-bold rounded-sm ml-1">ğŸ“ ${i.location}</span>` : ''}
                                            <span class="font-bold text-lg leading-none ${i.checked?'line-through':''} ml-1">${i.item}</span>
                                        </div>
                                        <div class="text-xs text-gray-500 font-bold ml-1">${i.note || ''}</div>
                                    </div>
                                    <button onclick="event.stopPropagation();deleteShopItem('${i.id}')" class="text-gray-300 hover:text-red-500 transition-colors p-2 ml-2"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                                </div>`).join('')}
                            ${appData.shoppingList.length === 0 ? '<div class="p-10 text-center text-gray-300 font-bold uppercase italic text-xs">No Items</div>' : ''}
                        </div>
                    </div>
                     <div class="lg:col-span-4 order-1 lg:order-3 space-y-4">
                        <div class="bg-white border border-tokyo-ink p-4 shadow-sm sticky top-6 text-center">
                            <h3 class="text-base font-bold border-b border-tokyo-ink pb-2 mb-4 uppercase tracking-widest">Inventory</h3>
                            <div class="mb-6"><div class="flex justify-between items-center text-[10px] mb-1 font-bold uppercase"><span>Status</span><span>${done}/${total}</span></div>
                                <div class="w-full bg-tokyo-gray h-2 border border-tokyo-ink"><div class="bg-tokyo-blue h-full transition-all" style="width: ${total>0? (done/total)*100 : 0}%"></div></div>
                            </div>
                            <button onclick="exportCSV('shopping')" class="w-full py-3 bg-tokyo-ink text-white font-bold text-[10px] hover:bg-tokyo-blue transition-all flex items-center justify-center gap-2 shadow uppercase tracking-widest"><i data-lucide="file-spreadsheet" class="w-4 h-4"></i> Export CSV</button>
                            <div class="grid grid-cols-2 gap-2 mb-3">
                                <button onclick="exportJSON('shopping')" class="py-2 border border-tokyo-ink font-bold text-[9px] uppercase hover:bg-tokyo-bg">Download File</button>
                                <button onclick="document.getElementById('fileImportShopping').click()" class="py-2 border border-tokyo-ink font-bold text-[9px] uppercase hover:bg-tokyo-bg">Import File</button>
                            </div>
                            <button onclick="toggleDataMode()" class="w-full py-2 border-2 border-tokyo-blue text-tokyo-blue font-bold text-[10px] uppercase hover:bg-blue-50 transition-all flex items-center justify-center gap-2">ğŸ“‹ ${currentState.showTextBackup ? 'éš±è—å‚™ä»½ç¢¼' : 'é¡¯ç¤ºæ–‡å­—å‚™ä»½ç¢¼'}</button>
                            ${currentState.showTextBackup ? `
                                <div class="mt-3 p-2 bg-gray-50 border border-tokyo-ink text-left">
                                    <p class="text-[9px] font-bold text-gray-500 mb-1">è¤‡è£½æ­¤ä»£ç¢¼ä¿å­˜ï¼š</p>
                                    <textarea id="backupCodeArea" class="w-full h-32 p-1 text-[9px] font-mono border border-gray-300 mb-2 focus:border-tokyo-blue outline-none" onclick="this.select()">${backupText}</textarea>
                                    <button onclick="restoreFromDataCode()" class="w-full py-2 bg-tokyo-ink text-white font-bold text-[10px] uppercase hover:bg-tokyo-blue">è²¼ä¸Šä¸¦é‚„åŸ</button>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>`;
             document.getElementById('content-area').innerHTML = html;
             lucide.createIcons();
        }

        // --- è¡Œææ¸²æŸ“ (Updated) ---
        function addPackingItem() {
            const name = document.getElementById('packName').value.trim();
            const cat = document.getElementById('packCat').value.trim() || 'å…¶ä»–';
            if(!name) return;
            appData.packingList.unshift({ id: 'p_'+Date.now(), category: cat, item: name, checked: false });
            saveAll(); renderPacking();
        }
        function togglePackingCheck(id) { const x = appData.packingList.find(a=>a.id===id); if(x) { x.checked = !x.checked; saveAll(); renderContent(); } }
        function deletePackingItem(id) { if(confirm('åˆªé™¤ï¼Ÿ')){ appData.packingList = appData.packingList.filter(x=>x.id!==id); saveAll(); renderPacking(); } }
        function renderPacking() {
            const grouped = appData.packingList.reduce((acc, item) => { if(!acc[item.category]) acc[item.category] = []; acc[item.category].push(item); return acc; }, {});
            
            let html = '';
            if (currentState.activeTab === 'toolbox') html += getBackHeaderHTML('è¡Œææ¸…å–®', 'Packing Checklist');

            html += `
                <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 lg:gap-10">
                    <div class="lg:col-span-8 order-2 space-y-6">
                        <div class="bg-white border border-tokyo-ink p-4 shadow-sm">
                             <h4 class="font-bold border-b border-tokyo-ink pb-2 mb-4 text-xs uppercase tracking-wider text-tokyo-blue">New Item</h4>
                             <div class="flex gap-3">
                                <input id="packCat" list="packCatOpts" class="border border-tokyo-ink p-2 text-sm w-1/3 outline-none" placeholder="é¡åˆ¥ (å¯è‡ªè¨‚)">
                                <input id="packName" class="border border-tokyo-ink p-2 text-sm w-2/3 outline-none font-bold" placeholder="ç‰©å“åç¨±">
                                <button onclick="addPackingItem()" class="bg-tokyo-ink text-white px-4 font-bold text-xs uppercase">Add</button>
                             </div>
                        </div>
                        <div class="space-y-6">
                            ${Object.keys(grouped).length === 0 ? '<div class="p-10 text-center text-gray-300 font-bold uppercase italic text-xs">List Empty</div>' : ''}
                            ${Object.keys(grouped).map(cat => `
                                <div>
                                    <h5 class="font-black text-sm uppercase tracking-widest mb-2 pl-2 border-l-4 border-tokyo-blue text-tokyo-ink">${cat}</h5>
                                    <div class="bg-white border border-tokyo-ink overflow-hidden">
                                        ${grouped[cat].map(i => `
                                            <div class="flex items-center p-3 border-b border-tokyo-ink last:border-b-0 hover:bg-tokyo-bg cursor-pointer group" onclick="togglePackingCheck('${i.id}')">
                                                <div class="w-5 h-5 border mr-3 flex items-center justify-center transition-all ${i.checked?'bg-tokyo-ink border-tokyo-ink text-white':'bg-white border-tokyo-ink'}">${i.checked?'<i data-lucide="check" class="w-3 h-3"></i>':''}</div>
                                                <div class="flex-grow font-bold text-base ${i.checked?'line-through opacity-30':''}">${i.item}</div>
                                                <button onclick="event.stopPropagation();deletePackingItem('${i.id}')" class="text-gray-300 hover:text-red-500 transition-colors p-2"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                                            </div>`).join('')}
                                    </div>
                                </div>`).join('')}
                        </div>
                    </div>
                    <div class="lg:col-span-4 order-1 lg:order-3 space-y-4">
                         <div class="bg-white border border-tokyo-ink p-4 shadow-sm sticky top-6 text-center">
                            <h3 class="text-base font-bold border-b border-tokyo-ink pb-2 mb-4 uppercase tracking-widest">Packing Tools</h3>
                             <div class="grid grid-cols-1 gap-2">
                                <button onclick="exportCSV('packing')" class="w-full py-3 bg-tokyo-ink text-white font-bold text-[10px] hover:bg-tokyo-blue transition-all flex items-center justify-center gap-2 shadow uppercase tracking-widest"><i data-lucide="file-spreadsheet" class="w-4 h-4"></i> Export CSV</button>
                                <div class="grid grid-cols-2 gap-2">
                                    <button onclick="exportJSON('packing')" class="py-2 border border-tokyo-ink font-bold text-[9px] uppercase hover:bg-tokyo-bg">Backup</button>
                                    <button onclick="document.getElementById('fileImportPacking').click()" class="py-2 border border-tokyo-ink font-bold text-[9px] uppercase hover:bg-tokyo-bg">Import</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>`;
            document.getElementById('content-area').innerHTML = html;
            lucide.createIcons();
        }

        function selectPhraseCategory(cat) {
            currentState.activePhraseCategory = cat;
            renderPhrases();
            window.scrollTo({top:0, behavior:'smooth'});
        }

        function resetPhraseCategory() {
            currentState.activePhraseCategory = null;
            renderPhrases();
            window.scrollTo({top:0, behavior:'smooth'});
        }

        function renderPhrases() {
            const cats = appData.phrases.categories;
            const icons = {
                'è¡Œç¨‹å°ˆå±¬': 'map-pin',
                'äº¤é€šç§»å‹•': 'train', 
                'ç¾é£Ÿé»é¤': 'utensils',
                'è³¼ç‰©é€€ç¨…': 'shopping-bag',
                'è§€å…‰åƒæ‹œ': 'camera',
                'ä½å®¿æ±‚åŠ©': 'help-circle'
            };

            const container = document.getElementById('content-area');
            let html = '';

            if (!currentState.activePhraseCategory) {
                if (currentState.activeTab === 'toolbox') html += getBackHeaderHTML('æŒ‡å·®æœƒè©±', 'Travel Phrases');
                
                html += `<div class="grid grid-cols-2 md:grid-cols-3 gap-4">`;
                cats.forEach(c => {
                    const iconName = icons[c] || 'message-circle';
                    html += `
                        <div onclick="selectPhraseCategory('${c}')" class="bg-white border-2 border-tokyo-ink p-6 cursor-pointer hover:-translate-y-1 hover:shadow-[4px_4px_0px_0px_#223A70] transition-all rounded-sm flex flex-col items-center justify-center gap-3 text-center h-40 group">
                            <div class="bg-tokyo-bg p-3 rounded-full group-hover:bg-tokyo-blue group-hover:text-white transition-colors">
                                <i data-lucide="${iconName}" class="w-8 h-8"></i>
                            </div>
                            <span class="font-bold text-lg text-tokyo-ink">${c}</span>
                        </div>
                    `;
                });
                html += `</div>`;
                
            } else {
                const currentCat = currentState.activePhraseCategory;
                const items = appData.phrases.items.filter(i => i.category === currentCat);
                const iconName = icons[currentCat] || 'message-circle';

                html += `
                    <div class="mb-6 flex items-center gap-4 border-b-2 border-tokyo-ink pb-4">
                        <button onclick="resetPhraseCategory()" class="bg-tokyo-ink text-white p-2 hover:bg-tokyo-blue transition-colors shadow-sm rounded-sm flex items-center gap-2 px-4 group">
                            <i data-lucide="arrow-left" class="w-4 h-4"></i>
                            <span class="text-xs font-bold uppercase">Back</span>
                        </button>
                        <div>
                            <h2 class="text-2xl font-serif font-bold tracking-tight text-tokyo-ink flex items-center gap-2">
                                <i data-lucide="${iconName}" class="w-6 h-6 text-tokyo-blue"></i> ${currentCat}
                            </h2>
                        </div>
                    </div>
                `;

                html += `<div class="space-y-4">`; 
                items.forEach((p, index) => {
                    const borderColor = index % 2 === 0 ? 'border-l-tokyo-blue' : 'border-l-tokyo-gold';
                    
                    html += `
                        <div onclick="playAudio('${p.jp}')" class="bg-white border border-tokyo-ink border-l-[6px] ${borderColor} p-5 shadow-sm hover:shadow-md hover:bg-gray-50 transition-all cursor-pointer relative group rounded-r-sm">
                            <div class="absolute top-3 right-3 text-gray-300 group-hover:text-tokyo-blue transition-colors">
                                <i data-lucide="volume-2" class="w-5 h-5"></i>
                            </div>
                            <p class="text-xl font-black text-tokyo-ink mb-2 pr-8 leading-snug">${p.jp}</p>
                            <p class="text-xs text-gray-500 font-mono mb-2">${p.ruby}</p>
                            <div class="border-t border-dashed border-gray-200 pt-2 mt-2">
                                <p class="text-base text-gray-700 font-bold flex items-center gap-2">
                                    <span class="text-[10px] bg-tokyo-gray text-tokyo-ink px-1.5 py-0.5 rounded-sm">TW</span>
                                    ${p.tw}
                                </p>
                            </div>
                        </div>
                    `;
                });
                html += `</div>`;
            }

            container.innerHTML = html;
            lucide.createIcons();
        }
        
        function renderItinerary(dayId) {
            const day = appData.itineraries[dayId];
            document.getElementById('content-area').innerHTML = `
                <div class="mb-8 p-6 bg-white border-l-[8px] border-tokyo-blue shadow-lg"><p class="text-lg opacity-90 mb-4 font-serif italic leading-relaxed text-justify">${day.intro}</p><a href="${getDailyRouteUrl(day.timeline)}" target="_blank" class="block w-full text-center bg-tokyo-ink text-white py-3 font-bold hover:bg-tokyo-blue transition-all uppercase tracking-widest shadow-md text-xs">Google Map Route</a></div>
                <div class="space-y-0 border-l-2 border-tokyo-ink ml-4 md:ml-0">${day.timeline.map((i, index) => {
                    let matched = appData.shoppingList ? appData.shoppingList.filter(s => 
                        s.location === i.title || 
                        (i.shoppingCategories && i.shoppingCategories.includes(s.category))
                    ) : [];

                    // Custom Link Button Logic
                    const linkBtnHtml = i.customLink 
                        ? `<button onclick="handleSpotLink('${dayId}', ${index}, event)" class="py-2 text-center bg-tokyo-blue text-white text-xs font-bold hover:bg-blue-800 transition-all flex items-center justify-center gap-1 rounded-sm shadow-md uppercase border border-tokyo-blue"><i data-lucide="link" class="w-3 h-3"></i> ${i.customLink.label}</button>`
                        : `<button onclick="handleSpotLink('${dayId}', ${index}, event)" class="py-2 text-center border-2 border-dashed border-gray-300 text-gray-400 text-xs font-bold hover:border-tokyo-blue hover:text-tokyo-blue transition-all flex items-center justify-center gap-1 rounded-sm uppercase"><i data-lucide="plus" class="w-3 h-3"></i> è‡ªè¨‚é€£çµ</button>`;

                    // Highlights Logic
                    let highlightsHtml = '';
                    if (i.highlights && i.highlights.length > 0) {
                        const isFood = i.tag === 'ç¾é£Ÿ';
                        const bgColor = isFood ? 'bg-orange-50' : 'bg-blue-50';
                        const borderColor = isFood ? 'border-orange-200' : 'border-blue-200';
                        const titleColor = isFood ? 'text-orange-800' : 'text-blue-800';
                        const textColor = isFood ? 'text-orange-900' : 'text-blue-900';
                        const title = isFood ? 'ğŸ”¥ å¿…åƒäººæ°£ä¸‰é¸' : 'âœ¨ å¿…åšäº”ä»¶äº‹';
                        
                        highlightsHtml = `
                            <div class="mt-4 ${bgColor} p-3 rounded border ${borderColor}">
                                <p class="text-[10px] font-bold ${titleColor} uppercase mb-2 tracking-wider">${title}</p>
                                <ul class="list-disc list-inside text-xs ${textColor} font-medium space-y-1">
                                    ${i.highlights.map(h => `<li>${h}</li>`).join('')}
                                </ul>
                            </div>
                        `;
                    }
                    
                    // Access / Navigation Logic
                    let accessHtml = '';
                    if (i.access) {
                         accessHtml = `
                            <div class="mt-4 p-3 bg-gray-100 border-l-4 border-gray-500 text-xs font-medium text-gray-700">
                                <div class="flex items-start gap-2">
                                    <i data-lucide="map" class="w-4 h-4 mt-0.5 flex-shrink-0"></i>
                                    <span>${i.access}</span>
                                </div>
                            </div>
                         `;
                    }

                    return `
                    <div class="grid grid-cols-1 md:grid-cols-12 gap-6 md:gap-8 mb-20 relative">
                        <div class="timeline-dot"></div>
                        <div class="md:col-span-2 md:text-right md:pr-4 pl-8"><span class="font-mono font-black text-xl bg-tokyo-ink text-tokyo-bg px-3 py-1 shadow-md inline-block mt-0.5">${i.time}</span></div>
                        <div class="md:col-span-10">
                            <div class="bg-white border-2 border-tokyo-ink p-6 hover:shadow-[8px_8px_0px_0px_#223A70] transition-all transform hover:-translate-y-1">
                                <div class="flex flex-wrap justify-between items-start gap-2 mb-3"><span class="text-[10px] font-bold text-tokyo-blue border border-tokyo-blue px-2 py-0.5 uppercase tracking-wider">${i.tag}</span><div class="flex gap-2">
                                    ${i.ratings?.google ? `<span class="bg-blue-50 text-blue-800 text-[10px] px-2 py-0.5 font-bold border border-blue-200 rounded-sm">G ${i.ratings.google}</span>` : ''}
                                    ${i.ratings?.tabelog ? `<span class="bg-orange-50 text-orange-800 text-[10px] px-2 py-0.5 font-bold border border-orange-200 rounded-sm">T ${i.ratings.tabelog}</span>` : ''}
                                </div></div>
                                <h3 class="text-2xl font-black font-serif mb-3 tracking-tight">${i.title}</h3>
                                <p class="text-sm mb-4 leading-relaxed opacity-90 text-justify font-medium">${i.desc}</p>
                                <div class="mb-4 p-3 bg-tokyo-bg border-l-4 border-tokyo-ink shadow-sm">
                                    <div class="text-[10px] font-black uppercase tracking-widest mb-1 flex items-center gap-1 text-tokyo-blue"><i data-lucide="camera" class="w-3 h-3"></i> Photo Guide</div>
                                    <p class="text-xs leading-5 text-tokyo-ink font-bold opacity-80">${i.photoTip}</p>
                                </div>
                                <div class="text-xs bg-gray-50 p-3 border border-tokyo-gray mb-4 rounded italic text-gray-500 font-bold shadow-sm">ğŸ’¡ ${i.tips}</div>
                                
                                ${accessHtml} <!-- Navigation / Access Info -->
                                ${highlightsHtml} <!-- Highlights Section -->

                                ${matched.length > 0 ? `
                                    <div class="mb-4 mt-4 p-3 border-2 border-purple-500/30 bg-purple-50 rounded">
                                        <div class="text-[10px] text-purple-700 font-black mb-2 uppercase tracking-wider flex items-center gap-2"><i data-lucide="shopping-bag" class="w-3 h-3"></i> Shopping Here:</div>
                                        <div class="space-y-2">${matched.map(item => `
                                            <div class="flex items-center group cursor-pointer" onclick="toggleShopCheck('${item.id}')">
                                                <div class="w-4 h-4 border mr-2 flex items-center justify-center bg-white ${item.checked ? 'text-green-600 border-green-600' : 'border-gray-400'}">${item.checked ? '<i data-lucide="check" class="w-3 h-3"></i>' : ''}</div>
                                                <span class="text-[9px] bg-tokyo-ink text-white px-1.5 py-0.5 mr-2 font-bold rounded uppercase">${item.recipient}</span>
                                                <span class="text-sm ${item.checked ? 'line-through opacity-40' : 'font-bold'}">${item.item}</span>
                                                ${item.location === i.title ? '<span class="ml-1 text-[8px] bg-purple-200 text-purple-800 px-1 rounded">MATCH</span>' : ''}
                                            </div>`).join('')}
                                        </div>
                                    </div>` : ''}
                                <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 mt-6">
                                    <a href="${getMapUrl(i.title)}" target="_blank" class="py-2 text-center border border-tokyo-ink text-xs font-bold hover:bg-tokyo-ink hover:text-white transition-all flex items-center justify-center gap-1 rounded-sm shadow-sm uppercase"><i data-lucide="map-pin" class="w-3 h-3"></i> Navi</a>
                                    <a href="${getSearchUrl(i.title)}" target="_blank" class="py-2 text-center border border-tokyo-ink text-xs font-bold hover:bg-tokyo-blue hover:text-white hover:border-tokyo-blue transition-all flex items-center justify-center gap-1 rounded-sm shadow-sm uppercase"><i data-lucide="search" class="w-3 h-3"></i> Info</a>
                                    ${i.ticketLink ? `<a href="${i.ticketLink}" target="_blank" class="py-2 text-center bg-tokyo-blue text-white text-xs font-bold hover:bg-blue-900 transition-all flex items-center justify-center gap-1 rounded-sm shadow-md uppercase"><i data-lucide="ticket" class="w-3 h-3"></i> Ticket</a>` : ''}
                                    ${linkBtnHtml} <!-- Custom Link Button -->
                                </div>
                            </div>
                        </div>
                    </div>`;
                }).join('')}</div>`;
            lucide.createIcons();
        }

        function renderFlightWidget() {
            const container = document.getElementById('flight-widget');
            const c = appData.config;

            if (c.isFlightEditMode) {
                container.innerHTML = `
                    <div class="bg-white border border-tokyo-ink p-4 shadow-sm space-y-3">
                        <span class="font-bold text-xs block border-b pb-1 text-tokyo-blue uppercase tracking-widest">Flight Settings</span>
                        
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-gray-500">å»ç¨‹ (Outbound)</label>
                            <input type="datetime-local" id="fOutDate" value="${c.outboundDate}" class="w-full border border-tokyo-ink p-1 text-xs font-mono font-bold outline-none">
                            <input type="text" id="fOutNo" value="${c.outboundNo}" placeholder="ex: JL96" class="w-full border border-tokyo-ink p-1 text-xs font-mono uppercase font-black outline-none">
                        </div>

                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-gray-500">å›ç¨‹ (Return)</label>
                            <input type="datetime-local" id="fRetDate" value="${c.returnDate}" class="w-full border border-tokyo-ink p-1 text-xs font-mono font-bold outline-none">
                            <input type="text" id="fRetNo" value="${c.returnNo}" placeholder="ex: JL99" class="w-full border border-tokyo-ink p-1 text-xs font-mono uppercase font-black outline-none">
                        </div>

                        <div class="flex gap-2 pt-2">
                            <button onclick="saveFlightSettings()" class="flex-1 bg-tokyo-ink text-white py-2 text-xs font-bold shadow hover:bg-tokyo-blue transition-colors">SAVE</button>
                            <button onclick="appData.config.isFlightEditMode=false;renderFlightWidget();" class="flex-1 border border-tokyo-ink py-2 text-xs font-bold">CANCEL</button>
                        </div>
                    </div>`;
            } else {
                const now = new Date();
                const outDate = c.outboundDate ? new Date(c.outboundDate) : null;
                const retDate = c.returnDate ? new Date(c.returnDate) : null;
                
                let status = "NO INFO";
                let targetDate = null;
                let flightNo = "--";
                let label = "Ready";

                if (outDate && now < outDate) {
                    status = "COUNTDOWN";
                    targetDate = outDate;
                    flightNo = c.outboundNo;
                    label = "To Tokyo";
                } else if (outDate && retDate && now >= outDate && now < retDate) {
                    status = "IN TRIP";
                    targetDate = retDate;
                    flightNo = c.returnNo;
                    label = "To Home";
                } else if (retDate && now >= retDate) {
                    status = "ENDED";
                }

                let cdText = "--";
                if (targetDate) {
                    const diff = targetDate - now;
                    const d = Math.floor(diff / 86400000);
                    const h = Math.floor((diff % 86400000) / 3600000);
                    cdText = `${d}d ${h}h`;
                } else if (status === "ENDED") {
                    cdText = "HOME";
                }

                container.innerHTML = `
                    <div class="bg-white border border-tokyo-ink p-4 shadow-sm relative group">
                        <button onclick="appData.config.isFlightEditMode=true;renderFlightWidget();" class="absolute top-2 right-2 text-gray-300 hover:text-tokyo-ink transition-colors p-1"><i data-lucide="settings" class="w-4 h-4"></i></button>
                        
                        <div class="flex justify-between border-b border-tokyo-ink pb-2 mb-3 font-bold text-tokyo-blue">
                            <span class="font-bold text-[10px] uppercase tracking-widest">Flight Status</span>
                            <span class="font-mono text-[10px] bg-tokyo-ink text-white px-2 py-0.5 uppercase font-bold rounded-sm">${label}</span>
                        </div>
                        
                        <div class="text-center mb-4">
                            <div class="text-3xl font-mono font-black tracking-tighter mb-1 text-tokyo-ink">${cdText}</div>
                            <div class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">${flightNo || '--'}</div>
                        </div>

                        <div class="space-y-2 border-t border-dashed border-gray-200 pt-3">
                            <div class="flex justify-between items-center ${outDate && now > outDate ? 'opacity-40' : ''}">
                                <div class="flex items-center gap-2">
                                    <i data-lucide="plane-takeoff" class="w-3 h-3 text-tokyo-blue"></i>
                                    <span class="text-[10px] font-bold">å»</span>
                                </div>
                                <div class="text-right">
                                    <div class="text-[10px] font-mono font-bold">${c.outboundDate ? new Date(c.outboundDate).toLocaleDateString() : '--/--'}</div>
                                    <div class="text-[9px] font-mono">${c.outboundNo || '--'}</div>
                                </div>
                            </div>
                            <div class="flex justify-between items-center ${retDate && now > retDate ? 'opacity-40' : ''}">
                                <div class="flex items-center gap-2">
                                    <i data-lucide="plane-landing" class="w-3 h-3 text-tokyo-blue"></i>
                                    <span class="text-[10px] font-bold">å›</span>
                                </div>
                                <div class="text-right">
                                    <div class="text-[10px] font-mono font-bold">${c.returnDate ? new Date(c.returnDate).toLocaleDateString() : '--/--'}</div>
                                    <div class="text-[9px] font-mono">${c.returnNo || '--'}</div>
                                </div>
                            </div>
                        </div>
                        
                        ${status !== 'ENDED' && status !== 'NO INFO' ? `
                            <div class="mt-3 pt-2 border-t border-tokyo-ink/10 text-center">
                                <div class="bg-green-600 text-white text-[9px] font-bold p-1 rounded-sm uppercase tracking-wider inline-block">
                                     Online Check-in Check
                                </div>
                            </div>
                        ` : ''}
                    </div>`;
            }
            lucide.createIcons();
        }

        function saveFlightSettings() {
            appData.config.outboundDate = document.getElementById('fOutDate').value;
            appData.config.outboundNo = document.getElementById('fOutNo').value;
            appData.config.returnDate = document.getElementById('fRetDate').value;
            appData.config.returnNo = document.getElementById('fRetNo').value;
            appData.config.isFlightEditMode = false;
            saveAll();
            renderFlightWidget();
        }

        function handleSpotLink(dayId, index, event) {
            if(event) event.stopPropagation();
            
            const item = appData.itineraries[dayId].timeline[index];
            const currentLink = item.customLink;

            if (currentLink) {
                try {
                    if (confirm(`å³å°‡å‰å¾€: ${currentLink.label}\n\n[ç¢ºå®š] é–‹å•Ÿç¶²é \n[å–æ¶ˆ] ç·¨è¼¯æˆ–åˆªé™¤é€£çµ`)) {
                        window.open(currentLink.url, '_blank');
                    } else {
                        const newLabel = prompt("ç·¨è¼¯é€£çµæ¨™é¡Œ (ç•™ç©ºåˆªé™¤):", currentLink.label);
                        if (newLabel === null) return;
                        if (newLabel.trim() === "") {
                            delete appData.itineraries[dayId].timeline[index].customLink;
                            saveAll();
                            renderItinerary(dayId);
                            showToast("ğŸ—‘ï¸ é€£çµå·²åˆªé™¤");
                        } else {
                            const newUrl = prompt("ç·¨è¼¯ç¶²å€:", currentLink.url);
                            if (newUrl) {
                                appData.itineraries[dayId].timeline[index].customLink = { label: newLabel, url: newUrl };
                                saveAll();
                                renderItinerary(dayId);
                                showToast("âœï¸ é€£çµå·²æ›´æ–°");
                            }
                        }
                    }
                } catch(e) { console.log("Link action cancelled or failed"); }
            } else {
                try {
                    const label = prompt("è«‹è¼¸å…¥è‡ªè¨‚é€£çµæ¨™é¡Œ (ä¾‹å¦‚: å¿…åƒé£Ÿè¨˜):");
                    if (label) {
                        const url = prompt("è«‹è¼¸å…¥ç¶²å€ (URL):", "https://");
                        if (url) {
                            appData.itineraries[dayId].timeline[index].customLink = { label, url };
                            saveAll();
                            renderItinerary(dayId);
                            showToast("ğŸ”— è‡ªè¨‚é€£çµå·²æ–°å¢");
                        }
                    }
                } catch(e) { console.log("Link creation cancelled"); }
            }
        }

        function runSystemCheck() {
            console.log("--- Tokyo App System Diagnosis ---");
            if (appData.itineraries && Object.keys(appData.itineraries).length === 5) {
                console.log("âœ… Itinerary Data Loaded");
            } else { console.warn("âš ï¸ Itinerary Data Missing"); }
            if ('speechSynthesis' in window) { console.log("âœ… Smart TTS Engine Available"); }
            else { console.warn("âš ï¸ Smart TTS Not Supported"); }
            showToast("âœ… ç³»çµ±å…¨åŠŸèƒ½å°±ç·’ | System Ready");
        }

        // --- 5. Initial Voice Loading & Play Function ---
        let voices = [];
        let currentUtterance = null; // Global reference to prevent GC

        function loadVoices() {
            voices = window.speechSynthesis.getVoices();
        }
        
        // Attempt to load voices immediately
        if ('speechSynthesis' in window) {
            loadVoices();
            // Chrome loads voices asynchronously
            window.speechSynthesis.onvoiceschanged = loadVoices;
        }

        function playAudio(text) {
            if (!('speechSynthesis' in window)) {
                showToast("âŒ è£ç½®ä¸æ”¯æ´èªéŸ³");
                return;
            }
            
            window.speechSynthesis.cancel(); // Stop previous
            
            // --- Audio Text Cleaning ---
            let speakText = text.replace(/[ï¼/]/g, 'ã€');
            speakText = speakText.replace(/[ï¼ˆ(]/g, ' ').replace(/[ï¼‰)]/g, '');
            
            // Create and assign to global variable
            currentUtterance = new SpeechSynthesisUtterance(speakText);
            currentUtterance.lang = 'ja-JP';
            currentUtterance.rate = 0.9; // Adjusted for better natural flow
            currentUtterance.pitch = 1.0;
            
            // Try to set voice if loaded
            if (voices.length === 0) voices = window.speechSynthesis.getVoices();
            
            // Smart Voice Selection: Google > Microsoft > Apple > Generic
            const jpVoices = voices.filter(v => v.lang === 'ja-JP' || v.lang === 'ja_JP' || v.lang.includes('ja'));
            const preferredVoice = jpVoices.find(v => v.name.includes('Google')) 
                                || jpVoices.find(v => v.name.includes('Microsoft')) 
                                || jpVoices.find(v => v.name.includes('Kyoko'))
                                || jpVoices[0];

            if (preferredVoice) currentUtterance.voice = preferredVoice;

            currentUtterance.onstart = () => showToast("ğŸ”Š ç™¼éŸ³ä¸­: " + speakText.substring(0, 10) + "...");
            currentUtterance.onerror = (e) => {
                console.error("TTS Error:", e);
                currentUtterance = null;
            };
            currentUtterance.onend = () => {
                currentUtterance = null; // Clear after finishing
            };

            window.speechSynthesis.speak(currentUtterance);
        }

        // --- Init ---
        window.onload = function() {
            loadAll(); fetchExchangeRate(); renderNav(); renderContent(); renderFlightWidget(); 
            // Force create icons for static header elements immediately
            lucide.createIcons();
            setInterval(renderFlightWidget, 60000);
            
            setTimeout(() => {
                if(document.getElementById('app-container')) {
                    runSystemCheck();
                } else {
                    alert("System Error: Critical DOM missing");
                }
            }, 500);
        };
    </script>
    <datalist id="recipientOpts"><option value="è‡ªå·±"><option value="å®¶äºº"><option value="åŒäº‹"><option value="æœ‹å‹"><option value="å®¢æˆ¶"></datalist>
    <datalist id="catOpts"><option value="è—¥å¦"><option value="ä¼´æ‰‹ç¦®"><option value="ç”Ÿæ´»é›œè²¨"><option value="é›»å™¨"><option value="æœé£¾"><option value="è§’è‰²é€±é‚Š"><option value="æ–‡å…·"></datalist>
    <datalist id="packCatOpts"><option value="è­‰ä»¶"><option value="è¡£ç‰©"><option value="é›»å­ç”¢å“"><option value="ç›¥æ´—/è—¥å“"><option value="å…¶ä»–"><option value="è‡ªè¨‚"></datalist>
</body>
</html>